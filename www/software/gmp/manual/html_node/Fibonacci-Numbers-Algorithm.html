<html lang="en">
<head>
<title>GNU MP 4.1</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name=description content="How to install and use the GNU multiple precision arithmetic library, version 4.1.">
<meta name=generator content="makeinfo 4.2">
<link href="http://www.gnu.org/software/texinfo/" rel=generator-home>
<!--
This manual describes how to install and use the GNU multiple precision
arithmetic library, version 4.1.

<p>Copyright 1991, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
Free Software Foundation, Inc.

<p>Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant Sections,
with the Front-Cover Texts being "A GNU Manual", and with the Back-Cover
Texts being "You have freedom to copy and modify this GNU Manual, like GNU
software".  A copy of the license is included in <a href="GNU-Free-Documentation-License.html#GNU%20Free%20Documentation%20License">GNU Free Documentation License</a>.-->
</head>
<body>
<p>
Node:<a name="Fibonacci%20Numbers%20Algorithm">Fibonacci Numbers Algorithm</a>,
Next:<a rel=next accesskey=n href="Lucas-Numbers-Algorithm.html#Lucas%20Numbers%20Algorithm">Lucas Numbers Algorithm</a>,
Previous:<a rel=previous accesskey=p href="Binomial-Coefficients-Algorithm.html#Binomial%20Coefficients%20Algorithm">Binomial Coefficients Algorithm</a>,
Up:<a rel=up accesskey=u href="Other-Algorithms.html#Other%20Algorithms">Other Algorithms</a>
<hr><br>

<h4>Fibonacci Numbers</h4>

<p>The Fibonacci functions <code>mpz_fib_ui</code> and <code>mpz_fib2_ui</code> are designed
for calculating isolated F[n] or F[n],F[n-1]
values efficiently.

<p>For small n, a table of single limb values in <code>__gmp_fib_table</code> is
used.  On a 32-bit limb this goes up to F[47], or on a 64-bit limb
up to F[93].  For convenience the table starts at F[-1].

<p>Beyond the table, values are generated with a binary powering algorithm,
calculating a pair F[n] and F[n-1] working from high to
low across the bits of n.  The formulas used are

<br><pre>F[2k+1] = 4*F[k]^2 - F[k-1]^2 + 2*(-1)^k
F[2k-1] =   F[k]^2 + F[k-1]^2

F[2k] = F[2k+1] - F[2k-1]
</pre>

<p>At each step, k is the high b bits of n.  If the next bit
of n is 0 then F[2k],F[2k-1] is used, or if
it's a 1 then F[2k+1],F[2k] is used, and the process
repeated until all bits of n are incorporated.  Notice these formulas
require just two squares per bit of n.

<p>It'd be possible to handle the first few n above the single limb table
with simple additions, using the defining Fibonacci recurrence F[k+1]=F[k]+F[k-1], but this is not done since it usually
turns out to be faster for only about 10 or 20 values of n, and
including a block of code for just those doesn't seem worthwhile.  If they
really mattered it'd be better to extend the data table.

<p>Using a table avoids lots of calculations on small numbers, and makes small
n go fast.  A bigger table would make more small n go fast, it's
just a question of balancing size against desired speed.  For GMP the code is
kept compact, with the emphasis primarily on a good powering algorithm.

<p><code>mpz_fib2_ui</code> returns both F[n] and F[n-1], but
<code>mpz_fib_ui</code> is only interested in F[n].  In this case the last
step of the algorithm can become one multiply instead of two squares.  One of
the following two formulas is used, according as n is odd or even.

<br><pre>F[2k]   = F[k]*(F[k]+2F[k-1])

F[2k+1] = (2F[k]+F[k-1])*(2F[k]-F[k-1]) + 2*(-1)^k
</pre>

<p>F[2k+1] here is the same as above, just rearranged to be a
multiply.  For interest, the 2*(-1)^k term both here and above
can be applied just to the low limb of the calculation, without a carry or
borrow into further limbs, which saves some code size.  See comments with
<code>mpz_fib_ui</code> and the internal <code>mpn_fib2_ui</code> for how this is done.

</body></html>


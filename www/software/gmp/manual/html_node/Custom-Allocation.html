<html lang="en">
<head>
<title>GNU MP 4.1</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name=description content="How to install and use the GNU multiple precision arithmetic library, version 4.1.">
<meta name=generator content="makeinfo 4.2">
<link href="http://www.gnu.org/software/texinfo/" rel=generator-home>
<!--
This manual describes how to install and use the GNU multiple precision
arithmetic library, version 4.1.

<p>Copyright 1991, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
Free Software Foundation, Inc.

<p>Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant Sections,
with the Front-Cover Texts being "A GNU Manual", and with the Back-Cover
Texts being "You have freedom to copy and modify this GNU Manual, like GNU
software".  A copy of the license is included in <a href="GNU-Free-Documentation-License.html#GNU%20Free%20Documentation%20License">GNU Free Documentation License</a>.-->
</head>
<body>
<p>
Node:<a name="Custom%20Allocation">Custom Allocation</a>,
Next:<a rel=next accesskey=n href="Language-Bindings.html#Language%20Bindings">Language Bindings</a>,
Previous:<a rel=previous accesskey=p href="BSD-Compatible-Functions.html#BSD%20Compatible%20Functions">BSD Compatible Functions</a>,
Up:<a rel=up accesskey=u href="index.html#Top">Top</a>
<hr><br>

<h2>Custom Allocation</h2>

<p>By default GMP uses <code>malloc</code>, <code>realloc</code> and <code>free</code> for memory
allocation, and if they fail GMP prints a message to the standard error output
and terminates the program.

<p>Alternate functions can be specified to allocate memory in a different way or
to have a different error action on running out of memory.

<p>This feature is available in the Berkeley compatibility library (see <a href="BSD-Compatible-Functions.html#BSD%20Compatible%20Functions">BSD Compatible Functions</a>) as well as the main GMP library.

<p>
<table width="100%">
<tr>
<td align="left">void <b>mp_set_memory_functions</b><i> (<br> void *(*<var>alloc_func_ptr</var>) (size_t), <br> void *(*<var>realloc_func_ptr</var>) (void *, size_t, size_t), <br> void (*<var>free_func_ptr</var>) (void *, size_t))
</i></td>
<td align="right">Function</td>
</tr>
</table>
<table width="95%" align="center">
<tr><td>
Replace the current allocation functions from the arguments.  If an argument
is <code>NULL</code>, the corresponding default function is used.

<p>These functions will be used for all memory allocation done by GMP, apart from
temporary space from <code>alloca</code> if that function is available and GMP is
configured to use it (see <a href="Build-Options.html#Build%20Options">Build Options</a>).

<p><strong>Be sure to call <code>mp_set_memory_functions</code> only when there are no
active GMP objects allocated using the previous memory functions!  Usually
that means calling it before any other GMP function.</strong>
</td></tr>
</table>

<p>The functions supplied should fit the following declarations:

<p>
<table width="100%">
<tr>
<td align="left">void * <b>allocate_function</b><i> (size_t <var>alloc_size</var>)
</i></td>
<td align="right">Function</td>
</tr>
</table>
<table width="95%" align="center">
<tr><td>
Return a pointer to newly allocated space with at least <var>alloc_size</var>
bytes. 
</td></tr>
</table>

<p>
<table width="100%">
<tr>
<td align="left">void * <b>reallocate_function</b><i> (void *<var>ptr</var>, size_t <var>old_size</var>, size_t <var>new_size</var>)
</i></td>
<td align="right">Function</td>
</tr>
</table>
<table width="95%" align="center">
<tr><td>
Resize a previously allocated block <var>ptr</var> of <var>old_size</var> bytes to be
<var>new_size</var> bytes.

<p>The block may be moved if necessary or if desired, and in that case the
smaller of <var>old_size</var> and <var>new_size</var> bytes must be copied to the new
location.  The return value is a pointer to the resized block, that being the
new location if moved or just <var>ptr</var> if not.

<p><var>ptr</var> is never <code>NULL</code>, it's always a previously allocated block. 
<var>new_size</var> may be bigger or smaller than <var>old_size</var>. 
</td></tr>
</table>

<p>
<table width="100%">
<tr>
<td align="left">void <b>deallocate_function</b><i> (void *<var>ptr</var>, size_t <var>size</var>)
</i></td>
<td align="right">Function</td>
</tr>
</table>
<table width="95%" align="center">
<tr><td>
De-allocate the space pointed to by <var>ptr</var>.

<p><var>ptr</var> is never <code>NULL</code>, it's always a previously allocated block of
<var>size</var> bytes. 
</td></tr>
</table>

<p>A <dfn>byte</dfn> here means the unit used by the <code>sizeof</code> operator.

<p>The <var>old_size</var> parameters to <var>reallocate_function</var> and
<var>deallocate_function</var> are passed for convenience, but of course can be
ignored if not needed.  The default functions using <code>malloc</code> and friends
for instance don't use them.

<p>No error return is allowed from any of these functions, if they return then
they must have performed the specified operation.  In particular note that
<var>allocate_function</var> or <var>reallocate_function</var> mustn't return
<code>NULL</code>.

<p>Getting a different fatal error action is a good use for custom allocation
functions, for example giving a graphical dialog rather than the default print
to <code>stderr</code>.  How much is possible when genuinely out of memory is
another question though.

<p>There's currently no defined way for the allocation functions to recover from
an error such as out of memory, they must terminate program execution.  A
<code>longjmp</code> or throwing a C++ exception will have undefined results.  This
may change in the future.

<p>GMP may use allocated blocks to hold pointers to other allocated blocks.  This
will limit the assumptions a conservative garbage collection scheme can make.

<p>Since the default GMP allocation uses <code>malloc</code> and friends, those
functions will be linked in even if the first thing a program does is an
<code>mp_set_memory_functions</code>.  It's necessary to change the GMP sources if
this is a problem.

</body></html>


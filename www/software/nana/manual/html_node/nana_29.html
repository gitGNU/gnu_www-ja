<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.52
     from ../texi/nana.texi on 6 November 1998 -->

<TITLE>GNU Nana: improved support for assertions and logging in C and C++ - eiffel.h</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="nana_1.html">first</A>, <A HREF="nana_28.html">previous</A>, <A HREF="nana_30.html">next</A>, <A HREF="nana_42.html">last</A> section, <A HREF="nana_toc.html">table of contents</A>.
<P><HR><P>


<H2><A NAME="SEC29" HREF="nana_toc.html#TOC29">eiffel.h: eiffel type assertions</A></H2>
<P>
Eiffel is a very nice language which provides the assertion checking
facilities of nana inside the language itself.  The <SAMP>`eiffel.h'</SAMP>
library is intended to provide a similar setup to Eiffel in the C++
language. It is a pretty poor emulation, but it is hopefully
better than nothing.

</P>
<P>
Assertion checking is controlled by the <VAR>EIFFEL_CHECK</VAR> variable
which can take on any of the following values:

</P>
<DL COMPACT>

<DT><CODE>CHECK_NO</CODE>
<DD>
<A NAME="IDX170"></A>
Disable all checking.
<DT><CODE>CHECK_REQUIRE</CODE>
<DD>
<A NAME="IDX171"></A>
Check the preconditions for each method.
<DT><CODE>CHECK_ENSURE</CODE>
<DD>
<A NAME="IDX172"></A>
And also check the postconditions.
<DT><CODE>CHECK_INVARIANT</CODE>
<DD>
<A NAME="IDX173"></A>
And also check the class invariant before and after each method is
called. The programmer should provide a class method called
<SAMP>`invariant'</SAMP> which returns <SAMP>`true'</SAMP> if the object is consistent, 
<SAMP>`false'</SAMP> otherwise.
<DT><CODE>CHECK_LOOP</CODE>
<DD>
<A NAME="IDX174"></A>
And also check the loop invariants.
<DT><CODE>CHECK_ALL</CODE>
<DD>
<A NAME="IDX175"></A>
And also check any assertions using the <SAMP>`CHECK'</SAMP> instruction.
</DL>

<P>
A typical compile flag to the compile might be:

</P>

<PRE>
% g++ -c -DEIFFEL_CHECK=CHECK_ALL play.cc
</PRE>

<P>
And then we have the actual assertion macros.

</P>
<P>
<DL>
<DT><U>Macro:</U> void <B>REQUIRE</B> <I>(<VAR>exprn</VAR>)</I>
<DD><A NAME="IDX176"></A>
Called at the beginning of each method.
This checks the precondition to a method and the class invariant.
</DL>

</P>
<P>
<DL>
<DT><U>Macro:</U> void <B>ENSURE</B> <I>(<VAR>exprn</VAR>)</I>
<DD><A NAME="IDX177"></A>
Called at the end of each method.
This checks the postcondition to a method and the class invariant.
</DL>

</P>
<P>
<DL>
<DT><U>Macro:</U> void <B>INVARIANT</B> <I>(<VAR>exprn</VAR>)</I>
<DD><A NAME="IDX178"></A>
Used to check a loop invariant.
</DL>

</P>
<P>
<DL>
<DT><U>Macro:</U> void <B>CHECK</B> <I>(<VAR>exprn</VAR>)</I>
<DD><A NAME="IDX179"></A>
Used for any other inline assertions.
</DL>

</P>
<P>
And finally a small example:

</P>

<PRE>
#include &#60;eiffel.h&#62;

class example {
  int nobjects;
  map&#60;location,string,locationlt&#62; layer;
public:
  bool invariant();
  void changeit(location l);
};

bool example::invariant() {
  return AO(i,layer,valid_location((*i).first)) &#38;&#38; 
         nobjects &#62;= 0;
}

void example::changeit(string n, location l) {
  REQUIRE(E1O(i,layer,(*i).second == n));
  ...;
  while(..) {
    INVARIANT(...);
    ...
    INVARIANT(...);
  }
  ...
  CHECK(x == 5);
  ...
  ENSURE(layer[l] == n);
}
</PRE>

<P>
Note that the invariant checking macro <SAMP>`example::invariant'</SAMP>
is called automatically on function entry/exit using the 
<SAMP>`REQUIRE'</SAMP> and <SAMP>`ENSURE'</SAMP> macros.

</P>
<P><HR><P>
Go to the <A HREF="nana_1.html">first</A>, <A HREF="nana_28.html">previous</A>, <A HREF="nana_30.html">next</A>, <A HREF="nana_42.html">last</A> section, <A HREF="nana_toc.html">table of contents</A>.
</BODY>
</HTML>

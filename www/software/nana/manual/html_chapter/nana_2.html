<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.52
     from ../texi/nana.texi on 6 November 1998 -->

<TITLE>GNU Nana: improved support for assertions and logging in C and C++ - Installing the Nana library</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="nana_1.html">first</A>, <A HREF="nana_1.html">previous</A>, <A HREF="nana_3.html">next</A>, <A HREF="nana_8.html">last</A> section, <A HREF="nana_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC5" HREF="nana_toc.html#TOC5">Installing the Nana library</A></H1>
<P>
Nana uses the normal GNU install method in the same way as <SAMP>`gcc'</SAMP>
and <SAMP>`gdb'</SAMP>. To install nana in the default location
<SAMP>`/usr/local/{bin,lib,include}'</SAMP> you would use:

</P>

<PRE>
% gzcat nana-1.10.tar.gz | tar xvf -
% cd nana-1.10
% ./configure 
% make
% make install
% make check
% make check-mail
% make subscribe 
</PRE>

<P>
The <VAR>check-mail</VAR> and <VAR>subscribe</VAR> targets both send e-mail. If
you need to change the mailer used try something like:

</P>

<PRE>
% make MAIL=elm subscribe
</PRE>

<P>
<STRONG>Note:</STRONG> we need to install nana before running the <SAMP>`make check'</SAMP> 
target. The <SAMP>`check-mail'</SAMP> target sends the test report
via e-mail to the <SAMP>`nana-bug@cs.ntu.edu.au'</SAMP>.

</P>
<P>
Of course things are never that simple.  If you want to install Nana in
a different location or change the behaviour on error detection see section <A HREF="nana_2.html#SEC8">Configure</A>.

</P>
<P>
Each of the sub-directories nana can be compiled and installed
separately, e.g. if you don't need the documentation you can just
compile and install from the <SAMP>`src'</SAMP> sub-directory after doing the
configure statement.

</P>



<H2><A NAME="SEC6" HREF="nana_toc.html#TOC6">Required Software</A></H2>
<P>
The following software is possibly required to run nana.

</P>
<DL COMPACT>

<DT><CODE>gcc-2.7.2</CODE>
<DD>
<A NAME="IDX7"></A>
Nana makes use of two GNU extensions in its library so you really should
be using <SAMP>`gcc'</SAMP>. Some of the code can be used with any C compiler,
though it may not be worth the bother. The dependencies on gcc are in 
<SAMP>`Q.h'</SAMP> which uses the statement value extension and in <SAMP>`L.h'</SAMP>
which uses the variable number of arguments extension to <SAMP>`cpp'</SAMP>.
<DT><CODE>gdb-4.16</CODE>
<DD>
<A NAME="IDX8"></A>
A recent version of <SAMP>`gdb'</SAMP> is worthwhile, some early 4.?? versions
had problems setting a large number of breakpoints.
<DT><CODE>gmake</CODE>
<DD>
<A NAME="IDX9"></A>
The <SAMP>`configure'</SAMP> script and <SAMP>`Makefiles'</SAMP> are generated using the
<SAMP>`automake'</SAMP> and <SAMP>`autoconf'</SAMP> programs. They should be reasonably
portable but if you have problems try using GNU make. For example on
some old DEC boxes we have had strange behaviour using the system make.
</DL>

<P>
For a listing of porting results including software versions see:

</P>
<P>
<SAMP>`http://www.cs.ntu.edu.au/homepages/pjm/nana-bug/'</SAMP>

</P>


<H2><A NAME="SEC7" HREF="nana_toc.html#TOC7">Optional Software</A></H2>

<P>
In addition to the required software you might also be interested
in:

</P>

<UL>
<LI><SAMP>`http://www.cs.tu-bs.de/softech/ddd/'</SAMP> -- a smart frontend for

gdb which can display dynamic data structures such as linked lists, etc.
<LI><SAMP>`ftp://ftp.ci.com.au/pub/psim/'</SAMP> -- a cycle level simulator

for the PowerPC. A fine piece of work.
</UL>



<H2><A NAME="SEC8" HREF="nana_toc.html#TOC8">Configure</A></H2>
<P>
Nana uses a standard GNU <CODE>autoconf</CODE> generated <CODE>configure</CODE>
script. The <CODE>configure</CODE> script checks the setup on your machine and
then generates the appropriate Makefiles. Some of the things checked by
configure include:

</P>

<OL>
<LI>Which compiler, compiler flags and libraries to use, e.g. you

might need to include a <CODE>-lposix</CODE> flag to the linker to build programs
on your machine.
<LI>Which header (.h) files are available on this machine, e.g. is

 <CODE>unistd.h</CODE> available on this machine.
<LI>Where to install programs, header file, man pages, etc.

</OL>

<P>
In addition <SAMP>`configure'</SAMP> uses the host architecture and operating system
to generate the <SAMP>`nana-config.h'</SAMP> file. This file contains some macro
definitions which define how nana works on particular operating systems
and hardware architectures. 

</P>
<P>
For example on <SAMP>`i386'</SAMP> machines we would use the <SAMP>`asm("hlt")'</SAMP>
instruction whenever an assertion fails, on a <SAMP>`sparc'</SAMP> we would use
<SAMP>`asm("stp")'</SAMP>. Otherwise we would default to a plain C call to
<SAMP>`abort()'</SAMP> If <SAMP>`configure'</SAMP> does not recognise your machine it
uses plain C code.

</P>
<P>
You may wish to change these defaults on installation, one method is to edit 
a local copy of the <SAMP>`nana-config.h'</SAMP> file. Alternately you can define 
the code yourself in the call to <SAMP>`configure'</SAMP>. For example
to redefine the action we take when an error is detected by the <CODE>I</CODE>
macro we can use: 

</P>

<PRE>
I_DEFAULT_HANDLER="restart_system()" ./configure
</PRE>

<P>
As well as simple calls to routines various other bits of information
are passed off to the <SAMP>`I_DEFAULT_HANDLER'</SAMP> such as the expression
that failure and a failure code. For example:

</P>

<PRE>
% I_DEFAULT_HANDLER="restart(line,file,param)" ./configure
</PRE>

<P>
The default for <SAMP>`I_DEFAULT_HANDLER'</SAMP> calls a function which prints a
message and then dumps core.  Different behaviour on failure can be
organised by setting the <SAMP>`I_DEFAULT'</SAMP> to <SAMP>`fast'</SAMP>, i.e. plain
core dump or <SAMP>`verbose'</SAMP> which prints an error messsage and then does
the core dump.

</P>

<PRE>
% I_DEFAULT=fast ./configure   
</PRE>

<P>
 
For nana the following examples may be useful:

</P>

<OL>
<LI><CODE>./configure</CODE>

Accept the default values for everything. In particular the files will
be installed in:

<SAMP>`/usr/local/{bin,include,lib,man,info}'</SAMP>

<LI><CODE>./configure --prefix=~project/tools</CODE>

Install the files into:

<SAMP>`~project/tools/{bin,include,lib,man,info}'</SAMP>

<LI><CODE>./configure --bindir=~project/bin --libdir=~/project/lib \<BR>

--includedir=~/project/headers --infodir=/usr/local/info \<BR>
--mandir=~/project/doc</CODE>

The install directory for program (<SAMP>`bin'</SAMP>), etc can all be set with
command line arguments to<SAMP>`configure'</SAMP>.

<LI><CODE>CC=xacc LIBS=-lposix ./configure sun3</CODE>

If the defaults chosen by <SAMP>`configure'</SAMP> are not correct you can
override them by setting variables such as <CODE>CC</CODE> before calling
 <SAMP>`configure'</SAMP>. The <SAMP>`sun3'</SAMP> argument is used to identify the
machine we are running on and may be necessary on some machines.

<LI><CODE>./configure --help</CODE>

And of course when in doubt ask for help.
</OL>

<P>
For even more details see the file <SAMP>`INSTALL.con'</SAMP> which contains the
generic instructions for use with <SAMP>`autoconf'</SAMP> generated
<SAMP>`configure'</SAMP> scripts.

</P>


<H2><A NAME="SEC9" HREF="nana_toc.html#TOC9">Variables for ./configure</A></H2>
<P>
The configure program uses the following shell variables to change
various defaults.  Another method is simply to edit the 
<SAMP>`nana-config.h'</SAMP> file. Most of these values should be auto detected,
so you can ignore this section until your need to save a few 
bytes of store by using <SAMP>`asm("hlt")'</SAMP> instead of a call to 
<SAMP>`abort()'</SAMP>. 

</P>
<DL COMPACT>

<DT><CODE>DI_MAKE_VALID_BREAKPOINT</CODE>
<DD>
<A NAME="IDX10"></A>
This text is inserted when the <SAMP>`DI.h'</SAMP> library needs to set a
breakpoint in the generated code. It should ideally update all
variables which being kept in registers etc so that gdb gets the
correct values for each variable.

Possible values include:


<OL>
<LI><SAMP>`asm("nop")'</SAMP> -- a single <SAMP>`nop'</SAMP> instruction to set the

breakpoint at.

This is the default.

<LI><SAMP>`_vi = 0'</SAMP> -- where <SAMP>`_vi'</SAMP> is a global volatile int.

<LI><SAMP>`_vi = (exprn)'</SAMP> -- where <VAR>exprn</VAR> is the expression

we are checking for this assertion.
<LI><SAMP>`/* nothing */'</SAMP> -- nothing at all, this means the breakpoint

will be set at the start of the next statement which works most of the
time. However for some examples this will do the wrong thing.
</OL>

<DT><CODE>DL_MAKE_VALID_BREAKPOINT</CODE>
<DD>
<A NAME="IDX11"></A>
Used for the same purpose as <SAMP>`DI_MAKE_VALID_BREAKPOINT'</SAMP> for
<SAMP>`DL.h'</SAMP>. It also defaults to <SAMP>`asm("nop")'</SAMP>.
<DT><CODE>I_DEFAULT_HANDLER</CODE>
<DD>
<A NAME="IDX12"></A>
The code called when <SAMP>`I.h'</SAMP> detects an error.
<DL COMPACT>

<DT><CODE>asm("hlt")</CODE>
<DD>
<A NAME="IDX13"></A>
Some machines use a <SAMP>`hlt'</SAMP> instruction.
<DT><CODE>asm("stp")</CODE>
<DD>
<A NAME="IDX14"></A>
And other machines use a <SAMP>`stp'</SAMP> instruction.
<DT><CODE>abort()</CODE>
<DD>
<A NAME="IDX15"></A>
Or we could use a call to <SAMP>`abort'</SAMP> which is at least standard C. On
some machines this is significantly larger than a single <SAMP>`hlt'</SAMP>
instruction. 
<DT><CODE>restart()</CODE>
<DD>
<A NAME="IDX16"></A>
Or a call to a function which attempts to restart the system.
</DL>
<DT><CODE>ALWAYS_INCLUDE_MALLOC</CODE>
<DD>
<A NAME="IDX17"></A>
This is a dodgey for some versions of Linux which don't seem to include 
<SAMP>`malloc'</SAMP> when you include <SAMP>`stdio.h'</SAMP> and use <SAMP>`print'</SAMP>. This
causes problems for <SAMP>`gdb'</SAMP> since it uses <SAMP>`malloc'</SAMP> in the
executable to implement parts of its functionality. 

This kludge should be removed!
</DL>



<H2><A NAME="SEC10" HREF="nana_toc.html#TOC10">Supported Platforms</A></H2>
<P>
Nana has been tested on the following platforms:

</P>

<OL>
<LI>i386-unknown-linux, gcc-2.7.0, gdb-4.16

<LI>sparc-sun-sunos4.1.4, gcc-2.7.2.f.1, gdb-4.16

<LI>sparc-sun-solaris2.3, gcc-2.7.2, gdb-4.16

<LI>alpha-dec-osf3.2, gcc-2.7.2, gdb-4.16

<LI>mips-sgi-irix5.3, gcc-2.7.0, gdb-4.16

<LI>powerpc-ibm-aix3.2.5, gcc-2.6.3, gdb-4.16

</OL>

<P>
The <SAMP>`alpha-dec-osf3.2'</SAMP>, <SAMP>`mips-sgi-irix5.3'</SAMP> and
<SAMP>`powerpc-ibm-aix3.2.5'</SAMP> implementations have problems when you
compile with <SAMP>`-O2'</SAMP> or <SAMP>`-O3'</SAMP> optimisation. This causes some
errors in the the debugger based assertion and logging code since
variables can be removed or changed by optimisation. At <SAMP>`-O'</SAMP>
everything passes. Regardless of optimisation the C based checking code
passes all tests on these platforms.

</P>
<P>
If you use nana on a new platform please send the <SAMP>`check.log'</SAMP> file
to <SAMP>`nana-bug@cs.ntu.edu.au'</SAMP> via the <SAMP>`make check-mail'</SAMP>
command. A machine generated list of this information is available 
at:

</P>
<P>
<SAMP>`http://www.cs.ntu.edu.au/homepages/pjm/nana-bug/'</SAMP>

</P>


<H2><A NAME="SEC11" HREF="nana_toc.html#TOC11">Supported Debuggers</A></H2>

<P>
Currently Nana works with the GNU GDB debugger which is available on a
wide range of platforms including embedded systems and even provides
support for remote debugging. 
Porting to any reasonable debugger with conditional
breakpoints and commands is not very difficult. 

</P>
<P>
As an example of an unreasonable debugger, Nana has been ported to
work with the MicroSoft Codeview debugger. The port is small (60 lines of
code) but suffers from a problem with variable scoping in Codeview. If
a breakpoint is set at a point in the code the expressions are not
evaluated from that particular scope. For example setting a breakpoint
in the function <CODE>f</CODE> cannot access a variable local to <CODE>f</CODE>
directly. Codeview has a unique (expletive deleted) scope operator
which you must use to set the scope <SAMP>`{...}'</SAMP>.  This makes the
interface somewhat less than beautiful.

</P>
<P>
Another good thing about CodeView is to try a debug command which prints a
message which contains a single open <SAMP>`{'</SAMP>. This of course causes it
to hang and was the main problem during the porting to CodeView which
took a whole day<A NAME="DOCF2" HREF="nana_foot.html#FOOT2">(2)</A>. 

</P>
<P>
If anyone is interested I may release the CodeView implementation,
please contact me if you are interested. Of course a better bet is probably 
to move to the <SAMP>`gdbserver'</SAMP> system. I think <SAMP>`gdb'</SAMP> has been released
as a native even for some MicroSoft operating systems.

</P>
<P>
Other debuggers like DBX don't seem to be worth the trouble since gdb
works on those machines. A redesign of the nana internals may also be useful
if we decide portability between debuggers is actually useful.

</P>


<H2><A NAME="SEC12" HREF="nana_toc.html#TOC12">Known Problems</A></H2>
<P>
Nana has the following known features (or perhaps problems):

</P>

<OL>
<LI>Nana macros which use the debugger

such as <CODE>DI</CODE> or <CODE>DL</CODE> should be on lines by themselves. If you
mix code and nana macros on the same line you will get errors, e.g:


<PRE>
main(){
   int x;
   x = 5; x--; DI(x == 4); 
}
</PRE>

This doesn't work since breakpoints are set at line boundaries rather
than statement ones. Of course anyone who writes code like this deserves
whatever happens to them.

<LI>Optimisation can remove variables so that debugger based

assertions (<SAMP>`DI.h'</SAMP>) do not work correctly. As usual the
interaction between the debugger and the compiler is rather
complicated. This may not be a problem if the appropriate compile-time
flags are selected, e.g. <SAMP>`-O0 and -O1'</SAMP> work on most platforms.

<LI>The <SAMP>`Q.h'</SAMP> macros depend on the statement value extension to

GNU CC so if you wish to use them you must use GCC. This can be fixed
for C++ in a possibly useful manner, I can't see any solution for C.

<LI>The logging macros depend on the Var Args extension provided by the

GNU C Preprocessor.<A NAME="DOCF3" HREF="nana_foot.html#FOOT3">(3)</A> We could (probably will) implement a fix for this 
based on the tricks in the C FAQ. Unfortunately these tricks are not pretty.
For now interested users could simply replace their CPP with the GNU CPP
if they wished to stay with non-standard compilers. 

<LI>The <SAMP>`Q.h'</SAMP> macros do not work in the debugger since <SAMP>`gdb'</SAMP>

does support the statement expression extension.

<LI>Multiline expressions do not work as expected in the debugger since

you need to use a blackslash as an escape at the end of the line. 
For example:


<PRE>
	 DI(x +
            10 &#62; 30);
</PRE>

A few backslashes may solve this particular problem.

<LI>Problems with the <SAMP>`configure'</SAMP> script.

The <SAMP>`configure'</SAMP> script automatically detects the target operating
system and architecture and then generates <SAMP>`nana-config.h'</SAMP>. If the
options selected in <SAMP>`nana-config.h'</SAMP> are incorrect they can be
edited by hand and installed in the usual include directory. The easiest
method is simply to delete all macros in <SAMP>`nana-config.h'</SAMP> since the
system defaults to more portable (and less efficient)
implementations. If you wish to do this from the configure script you 
can try giving a unsupported machine type, e.g.


<PRE>
% ./configure pdp11-dec-ultrix
</PRE>

<LI>Some users have reported problems with the <CODE>configure</CODE>

script detecting <CODE>vsnprintf</CODE>. If <CODE>configure</CODE> doesn't find it
and it does exist then simply define it in <SAMP>`nana-config.h'</SAMP> as per
the previous question. 

If <CODE>vsnprintf</CODE> really doesn't exist then get a new C library,
possibly the GNU libc.

<LI>The use of <CODE>vsprintf</CODE> opens a security hole since no

bounds checking is done by it. Nana attempts to use <CODE>vsnprintf</CODE>
which is safe when it exists but it will resort to <CODE>vsprintf</CODE>
if it can't find <CODE>vsnprintf</CODE>. All careful people should make
sure that they have a library with <CODE>vsnprintf</CODE>.

<LI><CODE>STL</CODE> header file errors due to nana.

The C++ <CODE>STL</CODE> header files for version 3.0 at least must
be included before the <CODE>Q.h</CODE> file. The problem is caused by the STL
files using <CODE>S</CODE> as a template argument. Of course <CODE>Q.h</CODE> uses
<CODE>S</CODE> for summing a series. Namespace pollution strikes again.

(Thanks to Han Holl for this particular problem).
</OL>



<H2><A NAME="SEC13" HREF="nana_toc.html#TOC13">Bug Reports</A></H2>

<P>
If you think you have found a bug in the Nana library, please
investigate it and report it.  

</P>

<UL>
<LI>Please make sure that the bug is really in the Nana library.

<LI>You have to send us a test case that makes it possible for us to

reproduce the bug.
<LI>You also have to explain what is wrong; if you get a crash, or if the

results printed are not good and in that case, in what way.
Make sure that the bug report includes all information you would
need to fix this kind of bug for someone else.  
</UL>

<P>
If your bug report is good, we will do our best to help you to get a
corrected version of the library; if the bug report is poor, we won't do
anything about it (apart from asking you to send better bug reports).

</P>
<P>
Send your bug report to:

</P>
<P>
<SAMP>`nana-bug@cs.ntu.edu.au'</SAMP>

</P>
<P>
Copies of bug reports will be kept at:

</P>
<P>
<SAMP>`http://www.cs.ntu.edu.au/homepages/pjm/nana-bug/'</SAMP>

</P>


<H2><A NAME="SEC14" HREF="nana_toc.html#TOC14">New Versions</A></H2>
<P>
New versions of nana will be made available at:

</P>
<P>
<SAMP>`ftp://ftp.cs.ntu.edu.au/pub/nana/'</SAMP> 

</P>
<P>
If you wish to be informed about new
releases of nana then subscribe to the nana mailing list. 
Send a message containing <SAMP>`subscribe'</SAMP> &#60;your e-mail address&#62; to:

</P>
<P>
<SAMP>`mailto:nana-request@it.ntu.edu.au'</SAMP>. 

</P>
<P>
A hypermail archive of this list is kept at:

</P>
<P>
<SAMP>`http://www.cs.ntu.edu.au/hypermail/nana-archive'</SAMP>

</P>
<P>
If you wish to send a message to the list send it to
<SAMP>`mailto:nana@it.ntu.edu.au'</SAMP>.

</P>
<P><HR><P>
Go to the <A HREF="nana_1.html">first</A>, <A HREF="nana_1.html">previous</A>, <A HREF="nana_3.html">next</A>, <A HREF="nana_8.html">last</A> section, <A HREF="nana_toc.html">table of contents</A>.
</BODY>
</HTML>

<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.52
     from ../texi/nana.texi on 6 November 1998 -->

<TITLE>GNU Nana: improved support for assertions and logging in C and C++ - Using Nana</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="nana_1.html">first</A>, <A HREF="nana_4.html">previous</A>, <A HREF="nana_6.html">next</A>, <A HREF="nana_8.html">last</A> section, <A HREF="nana_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC32" HREF="nana_toc.html#TOC32">Using Nana</A></H1>
<P>
This chapter is intended to provide some hopefully useful examples of
Nana. If any of the users of this library would be so kind as
to contribute a section on their usage I would be obliged. 

</P>
<P>
<STRONG>This section is under development</STRONG>

</P>



<H2><A NAME="SEC33" HREF="nana_toc.html#TOC33">Simplest example</A></H2>
<P>
As a nice simple, indeed trivial example consider the following:

</P>

<OL>
<LI>Include <SAMP>`nana.h'</SAMP> in your project wide include file.

<LI>Use <SAMP>`I'</SAMP> to check invariants in your code. In particular

all functions or methods should be required to check their pre and post
conditions.
<LI>Use <SAMP>`DL'</SAMP> to print debugging messages in your code. This means

that debugging messages only occur when you run the program under the
debugger.<A NAME="DOCF11" HREF="nana_foot.html#FOOT11">(11)</A>
</OL>



<H2><A NAME="SEC34" HREF="nana_toc.html#TOC34">Syslog</A></H2>
<P>
<SAMP>`syslog'</SAMP> is a comprehensive logging system written by Eric Allman
which is available on most Unix systems. It provides facilities for
sorting messages by source or severity and mechanisms for sending
messages off to files, terminals or other machines. See chapter 12 of
the "Unix System Administration Handbook (2nd Edition)" 
by Nemeth, Snyder, Seebass and Hein for an excellent tutorial on
<SAMP>`syslog'</SAMP>.

</P>
<P>
The rules used by <SAMP>`syslog'</SAMP> are normally defined in
<SAMP>`/etc/syslog.conf'</SAMP>. Each line specifies the destination for
messages with particular sources and priorities.  For example:

</P>

<PRE>
# log mail messages at priority info to mailinfo
mail.info /var/log/mailinfo
# log all ftp information to syslog on a remote machine
ftp.* @remote-machine.cs.ntu.edu.au
# all critical errors to console
*.crit   /dev/console
</PRE>

<P>
To use <SAMP>`syslog'</SAMP> we merely redefine the default handlers and
parameter values for <SAMP>`nana'</SAMP>. For example:

</P>

<PRE>
#include &#60;syslog.h&#62;
#define L_DEFAULT_HANDLER syslog /* replaces fprintf(3) by syslog(3) */
#define L_DEFAULT_PARAMS LOG_USER /* default priority for syslog info */
#include &#60;nana.h&#62;

int main() {
     openlog("nana", /* identifier for these log messages */
        LOG_PID, /* also log the process id */
        LOG_DAEMON /* facility */
     );

     L("temperature is falling to %d", 35); /* logged at LOG_USER priority */
     LP(LOG_CRIT, "the snow is falling in Darwin"); /* LOG_CRIT message */
        
     closelog();
     return 0;
}
</PRE>

<P>
This program results in the following addition to <SAMP>`/var/adm/messages'</SAMP>:

</P>

<PRE>
Jun 12 16:04:46 chingiz nana[2671]: the temperature is falling to 35
Jun 12 16:04:46 chingiz nana[2671]: the snow is falling in Darwin
</PRE>

<P>
In addition the <SAMP>`LOG_CRIT'</SAMP> message about snow falling in Darwin is
sent to the console for immediate action. 

</P>
<P>
<STRONG>Note:</STRONG> <SAMP>`syslog'</SAMP> normally uses <SAMP>`UDP'</SAMP> for its network
communications and that <SAMP>`UDP'</SAMP> does not guarantee delivery. 

</P>


<H2><A NAME="SEC35" HREF="nana_toc.html#TOC35">GNU Programs: how to avoid nana sometimes</A></H2>
<P>
Imagine you<A NAME="DOCF12" HREF="nana_foot.html#FOOT12">(12)</A> are building a GNU program.
Ideally it should run on systems without any other software including
GCC, GDB and even Nana. 

</P>
<P>
To achieve this noble goal you can provide your configure script
with a <SAMP>`--without-nana'</SAMP><A NAME="DOCF13" HREF="nana_foot.html#FOOT13">(13)</A> flag which then <SAMP>`#define's'</SAMP>
<SAMP>`WITHOUT_NANA'</SAMP>. You should also use the <SAMP>`VL'</SAMP> macro rather than
<SAMP>`L'</SAMP> macro since <SAMP>`L'</SAMP> takes a variable number of arguments and
will break non GNU C preprocessors. 

</P>

<PRE>
int half(int n) {
  /* Don't use L(...) since it takes a variable number of args! */
  VL(("hello world = %d\n", 10)); /* Note the doubled (( */
  ...;
}
</PRE>



<H2><A NAME="SEC36" HREF="nana_toc.html#TOC36">Embedded Systems: testing non-deterministic systems.</A></H2>
<P>
One of the uses (in fact the original use) for nana is in the 
testing of non-deterministic systems. These systems behave in a 
different way each time they are run because of timing or measurement
noise. Thus you can't just <SAMP>`diff'</SAMP> the results against a known good run
since they run differently each time. 

</P>
<P>
Instead you can use a series of programs which execute over a 
the results of the program and check that the behaviour meets the
specification automatically. 

</P>


<H2><A NAME="SEC37" HREF="nana_toc.html#TOC37">Realtime Systems</A></H2>
<P>
Assertions for the timing behaviour of you system can be done in nana
nicely. You might also consider using an instruction level simulator
such as PSIM and use the <SAMP>`cycles'</SAMP> variable to test realtime
constraints.

</P>


<H2><A NAME="SEC38" HREF="nana_toc.html#TOC38">A database</A></H2>
<P>
Ah databases, business boffins using assertions. It would nice
to get a real example for this one! 

</P>


<H2><A NAME="SEC39" HREF="nana_toc.html#TOC39">Program Visualisation: pretty pictures</A></H2>
<P>
One nice way to use <SAMP>`L'</SAMP>, <SAMP>`DL'</SAMP>, etc is to punt off the messages
off to a program which displays the information. You would use the
<SAMP>`L_DEFAULT_PARAM'</SAMP> argument to send commands off to a pipe with
gnuplot or TCL/TK interpreter running at the end. 

</P>
<P>
For a small example of this, see <SAMP>`tcl/status.c'</SAMP>. 

</P>
<P><HR><P>
Go to the <A HREF="nana_1.html">first</A>, <A HREF="nana_4.html">previous</A>, <A HREF="nana_6.html">next</A>, <A HREF="nana_8.html">last</A> section, <A HREF="nana_toc.html">table of contents</A>.
</BODY>
</HTML>

<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.52
     from ../texi/cvs.texinfo on 7 November 1998 -->

<TITLE>CVS--Concurrent Versions System - Keyword substitution</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="cvs_1.html">first</A>, <A HREF="cvs_16.html">previous</A>, <A HREF="cvs_18.html">next</A>, <A HREF="cvs_25.html">last</A> section, <A HREF="cvs_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC77" HREF="cvs_toc.html#TOC77">Keyword substitution</A></H1>
<P>
<A NAME="IDX269"></A>
<A NAME="IDX270"></A>
<A NAME="IDX271"></A>

</P>

<P>
As long as you edit source files inside your working
copy of a module you can always find out the state of
your files via <SAMP>`cvs status'</SAMP> and <SAMP>`cvs log'</SAMP>.
But as soon as you export the files from your
development environment it becomes harder to identify
which revisions they are.

</P>
<P>
RCS uses a mechanism known as <EM>keyword
substitution</EM> (or <EM>keyword expansion</EM>) to help
identifying the files.  Embedded strings of the form
<CODE>$<VAR>keyword</VAR>$</CODE> and
<CODE>$<VAR>keyword</VAR>:...$</CODE> in a file are replaced
with strings of the form
<CODE>$<VAR>keyword</VAR>:<VAR>value</VAR>$</CODE> whenever you obtain
a new revision of the file.

</P>



<H2><A NAME="SEC78" HREF="cvs_toc.html#TOC78">RCS Keywords</A></H2>
<P>
<A NAME="IDX272"></A>

</P>
<P>
This is a list of the keywords that RCS currently
(in release 5.6.0.1) supports:

</P>
<DL COMPACT>

<DT><CODE>$Author: ward $</CODE>
<DD>
<A NAME="IDX273"></A>
 
The login name of the user who checked in the revision.

<A NAME="IDX274"></A>
<DT><CODE>$Date: 2009/06/08 20:46:50 $</CODE>
<DD>
The date and time (UTC) the revision was checked in.

<A NAME="IDX275"></A>
<DT><CODE>$Header: /web/www/www/software/cvs/manual/html_chapter/cvs_17.html,v 1.2 2009/06/08 20:46:50 ward Exp $</CODE>
<DD>
A standard header containing the full pathname of the
RCS file, the revision number, the date (UTC), the
author, the state, and the locker (if locked).  Files
will normally never be locked when you use CVS.

<A NAME="IDX276"></A>
<DT><CODE>$Id: cvs_17.html,v 1.2 2009/06/08 20:46:50 ward Exp $</CODE>
<DD>
Same as <CODE>$Header: /web/www/www/software/cvs/manual/html_chapter/cvs_17.html,v 1.2 2009/06/08 20:46:50 ward Exp $</CODE>, except that the RCS
filename is without a path.

<A NAME="IDX277"></A>
<DT><CODE>$Name:  $</CODE>
<DD>
Tag name used to check out this file.

<A NAME="IDX278"></A>
<DT><CODE>$Locker:  $</CODE>
<DD>
The login name of the user who locked the revision
(empty if not locked, and thus almost always useless
when you are using CVS).

<A NAME="IDX279"></A>
<DT><CODE>$Log: cvs_17.html,v $
<DT><CODE>Revision 1.2  2009/06/08 20:46:50  ward
<DT><CODE>changes that were lost from the CVS tree due to the savannah crash of 2009/05/29
<DT><CODE>
<DT><CODE>Revision 1.1  2003/11/07 20:55:32  sinuhe
<DT><CODE>Add manual.
<DT><CODE></CODE>
<DD>
The log message supplied during commit, preceded by a
header containing the RCS filename, the revision
number, the author, and the date (UTC).  Existing log
messages are <EM>not</EM> replaced.  Instead, the new log
message is inserted after <CODE>$Log: cvs_17.html,v $
message is inserted after <CODE>Revision 1.1  2003/11/07 20:55:32  sinuhe
message is inserted after <CODE>Add manual.
message is inserted after <CODE></CODE>.
Each new line is prefixed with a <EM>comment leader</EM>
which RCS guesses from the file name extension.
It can be changed with <CODE>cvs admin -c</CODE>.
See section <A HREF="cvs_20.html#SEC92">admin options</A>.  This keyword is useful for
accumulating a complete change log in a source file,
but for several reasons it can be problematic.
See section <A HREF="cvs_17.html#SEC82">Problems with the $Log: cvs_17.html,v $
See section <A HREF="cvs_17.html#SEC82">Problems with the Revision 1.1  2003/11/07 20:55:32  sinuhe
See section <A HREF="cvs_17.html#SEC82">Problems with the Add manual.
See section <A HREF="cvs_17.html#SEC82">Problems with the keyword.</A>.

<A NAME="IDX280"></A>
<DT><CODE>$RCSfile: cvs_17.html,v $</CODE>
<DD>
The name of the RCS file without a path.

<A NAME="IDX281"></A>
<DT><CODE>$Revision: 1.2 $</CODE>
<DD>
The revision number assigned to the revision.

<A NAME="IDX282"></A>
<DT><CODE>$Source: /web/www/www/software/cvs/manual/html_chapter/cvs_17.html,v $</CODE>
<DD>
The full pathname of the RCS file.

<A NAME="IDX283"></A>
<DT><CODE>$State: Exp $</CODE>
<DD>
The state assigned to the revision.  States can be
assigned with <CODE>cvs admin -s</CODE>---See section <A HREF="cvs_20.html#SEC92">admin options</A>.

</DL>



<H2><A NAME="SEC79" HREF="cvs_toc.html#TOC79">Using keywords</A></H2>

<P>
To include a keyword string you simply include the
relevant text string, such as <CODE>$Id: cvs_17.html,v 1.2 2009/06/08 20:46:50 ward Exp $</CODE>, inside the
file, and commit the file.  CVS will automatically
expand the string as part of the commit operation.

</P>
<P>
It is common to embed <CODE>$</CODE>Id$ string in the
C source code.  This example shows the first few lines
of a typical file, after keyword substitution has been
performed:

</P>

<PRE>
static char *rcsid="$Id: cvs_17.html,v 1.2 2009/06/08 20:46:50 ward Exp $";
/* The following lines will prevent <CODE>gcc</CODE> version 2.<VAR>x</VAR>
   from issuing an "unused variable" warning. */
#if __GNUC__ == 2
#define USE(var) static void * use_##var = (&#38;use_##var, (void *) &#38;var) 
USE (rcsid);
#endif
</PRE>

<P>
Even though a clever optimizing compiler could remove
the unused variable <CODE>rcsid</CODE>, most compilers tend
to include the string in the binary.  Some compilers
have a <CODE>#pragma</CODE> directive to include literal text
in the binary.

</P>
<P>
<A NAME="IDX284"></A>
The <CODE>ident</CODE> command (which is part of the RCS
package) can be used to extract keywords and their
values from a file.  This can be handy for text files,
but it is even more useful for extracting keywords from
binary files.

</P>

<PRE>
$ ident samp.c
samp.c:
     $Id: cvs_17.html,v 1.2 2009/06/08 20:46:50 ward Exp $
$ gcc samp.c
$ ident a.out
a.out:
     $Id: cvs_17.html,v 1.2 2009/06/08 20:46:50 ward Exp $
</PRE>

<P>
<A NAME="IDX285"></A>
SCCS is another popular revision control system.
It has a command, <CODE>what</CODE>, which is very similar to
<CODE>ident</CODE> and used for the same purpose.  Many sites
without RCS have SCCS.  Since <CODE>what</CODE>
looks for the character sequence <CODE>@(#)</CODE> it is
easy to include keywords that are detected by either
command.  Simply prefix the RCS keyword with the
magic SCCS phrase, like this:

</P>

<PRE>
static char *id="@(#) $Id: cvs_17.html,v 1.2 2009/06/08 20:46:50 ward Exp $";
</PRE>



<H2><A NAME="SEC80" HREF="cvs_toc.html#TOC80">Avoiding substitution</A></H2>

<P>
Keyword substitution has its disadvantages.  Sometimes
you might want the literal text string
<SAMP>`$'</SAMP>Author$ to appear inside a file without
RCS interpreting it as a keyword and expanding it
into something like <SAMP>`$'</SAMP>Author: ceder $.  

</P>
<P>
There is unfortunately no way to selectively turn off
keyword substitution.  You can use <SAMP>`-ko'</SAMP>
(see section <A HREF="cvs_17.html#SEC81">Substitution modes</A>) to turn off keyword
substitution entirely.

</P>
<P>
In many cases you can avoid using RCS keywords in
the source, even though they appear in the final
product.  For example, the source for this manual
contains <SAMP>`$@asis{}Author$'</SAMP> whenever the text
<SAMP>`$'</SAMP>Author$ should appear.  In <CODE>nroff</CODE>
and <CODE>troff</CODE> you can embed the null-character
<CODE>\&#38;</CODE> inside the keyword for a similar effect.

</P>


<H2><A NAME="SEC81" HREF="cvs_toc.html#TOC81">Substitution modes</A></H2>
<P>
<A NAME="IDX286"></A>
<A NAME="IDX287"></A>

</P>
<P>
Each file has a stored default substitution mode, and
each working directory copy of a file also has a
substitution mode.  The former is set by the <SAMP>`-k'</SAMP>
option to <CODE>cvs add</CODE> and <CODE>cvs admin</CODE>; the
latter is set by the -k or -A options to <CODE>cvs
checkout</CODE> or <CODE>cvs update</CODE>.  <CODE>cvs diff</CODE> also
has a <SAMP>`-k'</SAMP> option.  For some examples,
See section <A HREF="cvs_18.html#SEC83">Handling binary files</A>.

</P>
<P>
The modes available are:

</P>
<DL COMPACT>

<DT><SAMP>`-kkv'</SAMP>
<DD>
Generate keyword strings using the default form, e.g.
<CODE>$</CODE>Revision: 5.7 $ for the <CODE>Revision</CODE>
keyword.

<DT><SAMP>`-kkvl'</SAMP>
<DD>
Like <SAMP>`-kkv'</SAMP>, except that a locker's name is always
inserted if the given revision is currently locked.
This option is normally not useful when CVS is used.

<DT><SAMP>`-kk'</SAMP>
<DD>
Generate only keyword names in keyword strings; omit
their values.  For example, for the <CODE>Revision</CODE>
keyword, generate the string <CODE>$</CODE>Revision$
instead of <CODE>$</CODE>Revision: 5.7 $.  This option
is useful to ignore differences due to keyword
substitution when comparing different revisions of a
file.

<DT><SAMP>`-ko'</SAMP>
<DD>
Generate the old keyword string, present in the working
file just before it was checked in.  For example, for
the <CODE>Revision</CODE> keyword, generate the string
<CODE>$</CODE>Revision: 1.1 $ instead of
<CODE>$</CODE>Revision: 5.7 $ if that is how the
string appeared when the file was checked in.

<DT><SAMP>`-kb'</SAMP>
<DD>
Like <SAMP>`-ko'</SAMP>, but also inhibit conversion of line
endings between the canonical form in which they are
stored in the repository (linefeed only), and the form
appropriate to the operating system in use on the
client.  For systems, like unix, which use linefeed
only to terminate lines, this is the same as
<SAMP>`-ko'</SAMP>.  For more information on binary files, see
section <A HREF="cvs_18.html#SEC83">Handling binary files</A>.

<DT><SAMP>`-kv'</SAMP>
<DD>
Generate only keyword values for keyword strings.  For
example, for the <CODE>Revision</CODE> keyword, generate the string
<CODE>5.7</CODE> instead of <CODE>$</CODE>Revision: 5.7 $.
This can help generate files in programming languages
where it is hard to strip keyword delimiters like
<CODE>$</CODE>Revision: $ from a string.  However,
further keyword substitution cannot be performed once
the keyword names are removed, so this option should be
used with care.

One often would like to use <SAMP>`-kv'</SAMP> with <CODE>cvs
export</CODE>---see section <A HREF="cvs_20.html#SEC108">export--Export sources from CVS, similar to checkout</A>.  But be aware that doesn't
handle an export containing binary files correctly.

</DL>



<H2><A NAME="SEC82" HREF="cvs_toc.html#TOC82">Problems with the $Log: cvs_17.html,v $
<H2><A NAME="SEC82" HREF="cvs_toc.html#TOC82">Problems with the Revision 1.1  2003/11/07 20:55:32  sinuhe
<H2><A NAME="SEC82" HREF="cvs_toc.html#TOC82">Problems with the Add manual.
<H2><A NAME="SEC82" HREF="cvs_toc.html#TOC82">Problems with the keyword.</A></H2>

<P>
The <CODE>$</CODE>Log$ keyword is somewhat
controversial.  As long as you are working on your
development system the information is easily accessible
even if you do not use the <CODE>$</CODE>Log$
keyword--just do a <CODE>cvs log</CODE>.  Once you export
the file the history information might be useless
anyhow.

</P>
<P>
A more serious concern is that RCS is not good at
handling <CODE>$</CODE>Log$ entries when a branch is
merged onto the main trunk.  Conflicts often result
from the merging operation.

</P>
<P>
People also tend to "fix" the log entries in the file
(correcting spelling mistakes and maybe even factual
errors).  If that is done the information from
<CODE>cvs log</CODE> will not be consistent with the
information inside the file.  This may or may not be a
problem in real life.

</P>
<P>
It has been suggested that the <CODE>$</CODE>Log$
keyword should be inserted <EM>last</EM> in the file, and
not in the files header, if it is to be used at all.
That way the long list of change messages will not
interfere with everyday source file browsing.

</P>
<P><HR><P>
Go to the <A HREF="cvs_1.html">first</A>, <A HREF="cvs_16.html">previous</A>, <A HREF="cvs_18.html">next</A>, <A HREF="cvs_25.html">last</A> section, <A HREF="cvs_toc.html">table of contents</A>.
</BODY>
</HTML>

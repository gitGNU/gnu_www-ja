<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.52
     from ../texi/cvs.texinfo on 7 November 1998 -->

<TITLE>CVS--Concurrent Versions System - Branches</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="cvs_1.html">first</A>, <A HREF="cvs_7.html">previous</A>, <A HREF="cvs_9.html">next</A>, <A HREF="cvs_25.html">last</A> section, <A HREF="cvs_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC50" HREF="cvs_toc.html#TOC50">Branches</A></H1>
<P>
<A NAME="IDX194"></A>
<A NAME="IDX195"></A>
<A NAME="IDX196"></A>

</P>
<P>
So far, all revisions shown in this manual have been on
the <EM>main trunk</EM>
of the revision tree, i.e., all revision numbers
have been of the form <VAR>x</VAR>.<VAR>y</VAR>.  One useful
feature, especially when maintaining several releases
of a software product at once, is the ability to make
branches on the revision tree.  <EM>Tags</EM>, symbolic
names for revisions, will also be
introduced in this chapter.

</P>



<H2><A NAME="SEC51" HREF="cvs_toc.html#TOC51">Tags--Symbolic revisions</A></H2>
<P>
<A NAME="IDX197"></A>

</P>
<P>
The revision numbers live a life of their own.  They
need not have anything at all to do with the release
numbers of your software product.  Depending
on how you use CVS the revision numbers might change several times
between two releases.  As an example, some of the
source files that make up RCS 5.6 have the following
revision numbers:
<A NAME="IDX198"></A>

</P>

<PRE>
ci.c            5.21
co.c            5.9
ident.c         5.3
rcs.c           5.12
rcsbase.h       5.11
rcsdiff.c       5.10
rcsedit.c       5.11
rcsfcmp.c       5.9
rcsgen.c        5.10
rcslex.c        5.11
rcsmap.c        5.2
rcsutil.c       5.10
</PRE>

<P>
<A NAME="IDX199"></A>
<A NAME="IDX200"></A>
<A NAME="IDX201"></A>
<A NAME="IDX202"></A>
You can use the <CODE>tag</CODE> command to give a symbolic name to a
certain revision of a file.  You can use the <SAMP>`-v'</SAMP> flag to the
<CODE>status</CODE> command to see all tags that a file has, and
which revision numbers they represent.  Tag names can
contain uppercase and lowercase letters, digits,
<SAMP>`-'</SAMP>, and <SAMP>`_'</SAMP>.  The two tag names <CODE>BASE</CODE>
and <CODE>HEAD</CODE> are reserved for use by CVS.  It
is expected that future names which are special to
CVS will contain characters such as <SAMP>`%'</SAMP> or
<SAMP>`='</SAMP>, rather than being named analogously to
<CODE>BASE</CODE> and <CODE>HEAD</CODE>, to avoid conflicts with
actual tag names.

</P>
<P>
<A NAME="IDX203"></A>
<A NAME="IDX204"></A>
The following example shows how you can add a tag to a
file.  The commands must be issued inside your working
copy of the module.  That is, you should issue the
command in the directory where <TT>`backend.c'</TT>
resides.

</P>

<PRE>
$ cvs tag release-0-4 backend.c
T backend.c
$ cvs status -v backend.c
===================================================================
File: backend.c         Status: Up-to-date

    Version:            1.4     Tue Dec  1 14:39:01 1992
    RCS Version:        1.4     /usr/local/cvsroot/yoyodyne/tc/backend.c,v
    Sticky Tag:         (none)
    Sticky Date:        (none)
    Sticky Options:     (none)

    Existing Tags:
        release-0-4                     (revision: 1.4)

</PRE>

<P>
There is seldom reason to tag a file in isolation.  A more common use is
to tag all the files that constitute a module with the same tag at
strategic points in the development life-cycle, such as when a release
is made.

</P>

<PRE>
$ cvs tag release-1-0 .
cvs tag: Tagging .
T Makefile
T backend.c
T driver.c
T frontend.c
T parser.c
</PRE>

<P>
(When you give CVS a directory as argument, it generally applies the
operation to all the files in that directory, and (recursively), to any
subdirectories that it may contain.  See section <A HREF="cvs_10.html#SEC60">Recursive behavior</A>.)

</P>
<P>
<A NAME="IDX205"></A>
<A NAME="IDX206"></A>
The <CODE>checkout</CODE> command has a flag, <SAMP>`-r'</SAMP>, that lets you check out
a certain revision of a module.  This flag makes it easy to
retrieve the sources that make up release 1.0 of the module <SAMP>`tc'</SAMP> at
any time in the future:

</P>

<PRE>
$ cvs checkout -r release-1-0 tc
</PRE>

<P>
This is useful, for instance, if someone claims that there is a bug in
that release, but you cannot find the bug in the current working copy.

</P>
<P>
You can also check out a module as it was at any given date.
See section <A HREF="cvs_20.html#SEC97">checkout options</A>.

</P>
<P>
When you tag more than one file with the same tag you
can think about the tag as "a curve drawn through a
matrix of filename vs. revision number."  Say we have 5
files with the following revisions:

</P>

<PRE>
        file1   file2   file3   file4   file5

        1.1     1.1     1.1     1.1  /--1.1*      &#60;-*-  TAG
        1.2*-   1.2     1.2    -1.2*-
        1.3  \- 1.3*-   1.3   / 1.3
        1.4          \  1.4  /  1.4
                      \-1.5*-   1.5
                        1.6
</PRE>

<P>
At some time in the past, the <CODE>*</CODE> versions were tagged.
You can think of the tag as a handle attached to the curve
drawn through the tagged revisions.  When you pull on
the handle, you get all the tagged revisions.  Another
way to look at it is that you "sight" through a set of
revisions that is "flat" along the tagged revisions,
like this:

</P>

<PRE>
        file1   file2   file3   file4   file5

                        1.1
                        1.2
                1.1     1.3                       _
        1.1     1.2     1.4     1.1              /
        1.2*----1.3*----1.5*----1.2*----1.1     (--- &#60;--- Look here
        1.3             1.6     1.3              \_
        1.4                     1.4
                                1.5
</PRE>



<H2><A NAME="SEC52" HREF="cvs_toc.html#TOC52">What branches are good for</A></H2>
<P>
<A NAME="IDX207"></A>
<A NAME="IDX208"></A>
<A NAME="IDX209"></A>

</P>
<P>
Suppose that release 1.0 of tc has been made.  You are continuing to
develop tc, planning to create release 1.1 in a couple of months.  After a
while your customers start to complain about a fatal bug.  You check
out release 1.0 (see section <A HREF="cvs_8.html#SEC51">Tags--Symbolic revisions</A>) and find the bug
(which turns out to have a trivial fix).  However, the current revision
of the sources are in a state of flux and are not expected to be stable
for at least another month.  There is no way to make a
bugfix release based on the newest sources.

</P>
<P>
The thing to do in a situation like this is to create a <EM>branch</EM> on
the revision trees for all the files that make up
release 1.0 of tc.  You can then make
modifications to the branch without disturbing the main trunk.  When the
modifications are finished you can select to either incorporate them on
the main trunk, or leave them on the branch.

</P>


<H2><A NAME="SEC53" HREF="cvs_toc.html#TOC53">Creating a branch</A></H2>
<P>
<A NAME="IDX210"></A>
<A NAME="IDX211"></A>
<A NAME="IDX212"></A>

</P>
<P>
The <CODE>rtag</CODE> command can be used to create a branch.
The <CODE>rtag</CODE> command is much like <CODE>tag</CODE>, but it
does not require that you have a working copy of the
module.  See section <A HREF="cvs_20.html#SEC126">rtag--Add a symbolic tag to a module</A>.  (You can also use the <CODE>tag</CODE>
command; see section <A HREF="cvs_20.html#SEC130">tag--Add a symbolic tag to checked out versions of files</A>).

</P>

<PRE>
$ cvs rtag -b -r release-1-0 release-1-0-patches tc
</PRE>

<P>
The <SAMP>`-b'</SAMP> flag makes <CODE>rtag</CODE> create a branch
(rather than just a symbolic revision name).  <SAMP>`-r
release-1-0'</SAMP> says that this branch should be rooted at the node (in
the revision tree) that corresponds to the tag
<SAMP>`release-1-0'</SAMP>.  Note that the numeric revision number that matches
<SAMP>`release-1-0'</SAMP> will probably be different from file to file.  The
name of the new branch is <SAMP>`release-1-0-patches'</SAMP>, and the
module affected is <SAMP>`tc'</SAMP>.

</P>
<P>
To fix the problem in release 1.0, you need a working
copy of the branch you just created.

</P>

<PRE>
$ cvs checkout -r release-1-0-patches tc
$ cvs status -v driver.c backend.c
===================================================================
File: driver.c          Status: Up-to-date

    Version:            1.7     Sat Dec  5 18:25:54 1992
    RCS Version:        1.7     /usr/local/cvsroot/yoyodyne/tc/driver.c,v
    Sticky Tag:         release-1-0-patches (branch: 1.7.2)
    Sticky Date:        (none)
    Sticky Options:     (none)

    Existing Tags:
        release-1-0-patches             (branch: 1.7.2)
        release-1-0                     (revision: 1.7)

===================================================================
File: backend.c         Status: Up-to-date

    Version:            1.4     Tue Dec  1 14:39:01 1992
    RCS Version:        1.4     /usr/local/cvsroot/yoyodyne/tc/backend.c,v
    Sticky Tag:         release-1-0-patches (branch: 1.4.2)
    Sticky Date:        (none)
    Sticky Options:     (none)

    Existing Tags:
        release-1-0-patches             (branch: 1.4.2)
        release-1-0                     (revision: 1.4)
        release-0-4                     (revision: 1.4)

</PRE>

<P>
<A NAME="IDX213"></A>
As the output from the <CODE>status</CODE> command shows the branch
number is created by adding a digit at the tail of the revision number
it is based on.  (If <SAMP>`release-1-0'</SAMP> corresponds to revision 1.4, the
branch's revision number will be 1.4.2.  For obscure reasons CVS always
gives branches even numbers, starting at 2.
See section <A HREF="cvs_3.html#SEC8">Revision numbers</A>).

</P>


<H2><A NAME="SEC54" HREF="cvs_toc.html#TOC54">Sticky tags</A></H2>
<P>
<A NAME="IDX214"></A>
<A NAME="IDX215"></A>
<A NAME="IDX216"></A>

</P>
<P>
The <SAMP>`-r release-1-0-patches'</SAMP> flag that was given
to <CODE>checkout</CODE> in the previous example
is <EM>sticky</EM>, that is, it will apply to subsequent commands
in this directory.  If you commit any modifications, they are
committed on the branch.  You can later merge the modifications into
the main trunk.  See section <A HREF="cvs_9.html#SEC55">Merging</A>.

</P>
<P>
You can use the <CODE>status</CODE> command to see what
sticky tags or dates are set:

</P>

<PRE>
$ vi driver.c   # Fix the bugs
$ cvs commit -m "Fixed initialization bug" driver.c
Checking in driver.c;
/usr/local/cvsroot/yoyodyne/tc/driver.c,v  &#60;--  driver.c
new revision: 1.7.2.1; previous revision: 1.7
done
$ cvs status -v driver.c
===================================================================
File: driver.c          Status: Up-to-date

    Version:            1.7.2.1 Sat Dec  5 19:35:03 1992
    RCS Version:        1.7.2.1 /usr/local/cvsroot/yoyodyne/tc/driver.c,v
    Sticky Tag:         release-1-0-patches (branch: 1.7.2)
    Sticky Date:        (none)
    Sticky Options:     (none)

    Existing Tags:
        release-1-0-patches             (branch: 1.7.2)
        release-1-0                     (revision: 1.7)

</PRE>

<P>
<A NAME="IDX217"></A>
<A NAME="IDX218"></A>
<A NAME="IDX219"></A>
The sticky tags will remain on your working files until
you delete them with <SAMP>`cvs update -A'</SAMP>.  The
<SAMP>`-A'</SAMP> option retrieves the version of the file from
the head of the trunk, and forgets any sticky tags,
dates, or options.

</P>
<P>
<A NAME="IDX220"></A>
Sticky tags are not just for branches.  For example,
suppose that you want to avoid updating your working
directory, to isolate yourself from possibly
destabilizing changes other people are making.  You
can, of course, just refrain from running <CODE>cvs
update</CODE>.  But if you want to avoid updating only a
portion of a larger tree, then sticky tags can help.
If you check out a certain revision (such as 1.4) it
will become sticky.  Subsequent <CODE>cvs update</CODE> will
not retrieve the latest revision until you reset the
tag with <CODE>cvs update -A</CODE>.  Likewise, use of the
<SAMP>`-D'</SAMP> option to <CODE>update</CODE> or <CODE>checkout</CODE>
sets a <EM>sticky date</EM>, which, similarly, causes that
date to be used for future retrievals.

</P>
<P>
<A NAME="IDX221"></A>
<A NAME="IDX222"></A>
Many times you will want to retrieve an old version of
a file without setting a sticky tag.  The way to do
that is with the <SAMP>`-p'</SAMP> option to <CODE>checkout</CODE> or
<CODE>update</CODE>, which sends the contents of the file to
standard output.  For example, suppose you have a file
named <TT>`file1'</TT> which existed as revision 1.1, and
you then removed it (thus adding a dead revision 1.2).
Now suppose you want to add it again, with the same
contents it had previously.  Here is how to do it:

</P>

<PRE>
$ cvs update -p -r 1.1 file1 &#62;file1
===================================================================
Checking out file1
RCS:  /tmp/cvs-sanity/cvsroot/first-dir/Attic/file1,v
VERS: 1.1
***************
$ cvs add file1
cvs add: re-adding file file1 (in place of dead revision 1.2)
cvs add: use 'cvs commit' to add this file permanently
$ cvs commit -m test
Checking in file1;
/tmp/cvs-sanity/cvsroot/first-dir/file1,v  &#60;--  file1
new revision: 1.3; previous revision: 1.2
done
$ 
</PRE>

<P><HR><P>
Go to the <A HREF="cvs_1.html">first</A>, <A HREF="cvs_7.html">previous</A>, <A HREF="cvs_9.html">next</A>, <A HREF="cvs_25.html">last</A> section, <A HREF="cvs_toc.html">table of contents</A>.
</BODY>
</HTML>

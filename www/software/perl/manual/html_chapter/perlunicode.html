<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by Texinfo 5.1.90+dev, http://www.gnu.org/software/texinfo/ -->
<head>
<title>Perl pod documentation: perlunicode</title>

<meta name="description" content="Perl pod documentation: perlunicode">
<meta name="keywords" content="Perl pod documentation: perlunicode">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.html#Top" rel="start" title="Top">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="index.html#Top" rel="up" title="Top">
<link href="perlunifaq.html#perlunifaq" rel="next" title="perlunifaq">
<link href="perltrap.html#perltrap-Perl-Traps" rel="prev" title="perltrap Perl Traps">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.indentedblock {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smallindentedblock {margin-left: 3.2em; font-size: smaller}
div.smalllisp {margin-left: 3.2em}
kbd {font-style:oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:nowrap}
span.nolinebreak {white-space:nowrap}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">
<a name="perlunicode"></a>
<div class="header">
<p>
Next: <a href="perlunifaq.html#perlunifaq" accesskey="n" rel="next">perlunifaq</a>, Previous: <a href="perltrap.html#perltrap" accesskey="p" rel="prev">perltrap</a>, Up: <a href="index.html#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="perlunicode-1"></a>
<h2 class="chapter">80 perlunicode</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-NAME" accesskey="1">perlunicode NAME</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-DESCRIPTION" accesskey="2">perlunicode DESCRIPTION</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-BUGS" accesskey="3">perlunicode BUGS</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-SEE-ALSO" accesskey="4">perlunicode SEE ALSO</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="perlunicode-NAME"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-DESCRIPTION" accesskey="n" rel="next">perlunicode DESCRIPTION</a>, Up: <a href="#perlunicode" accesskey="u" rel="up">perlunicode</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="NAME-79"></a>
<h3 class="section">80.1 NAME</h3>

<p>perlunicode - Unicode support in Perl
</p>
<hr>
<a name="perlunicode-DESCRIPTION"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-BUGS" accesskey="n" rel="next">perlunicode BUGS</a>, Previous: <a href="#perlunicode-NAME" accesskey="p" rel="prev">perlunicode NAME</a>, Up: <a href="#perlunicode" accesskey="u" rel="up">perlunicode</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="DESCRIPTION-78"></a>
<h3 class="section">80.2 DESCRIPTION</h3>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Important-Caveats" accesskey="1">perlunicode Important Caveats</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Byte-and-Character-Semantics" accesskey="2">perlunicode Byte and Character Semantics</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Effects-of-Character-Semantics" accesskey="3">perlunicode Effects of Character Semantics</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Unicode-Character-Properties" accesskey="4">perlunicode Unicode Character Properties</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-User_002dDefined-Character-Properties" accesskey="5">perlunicode User-Defined Character Properties</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-User_002dDefined-Case-Mappings-_0028for-serious-hackers-only_0029" accesskey="6">perlunicode User-Defined Case Mappings (for serious hackers only)</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Character-Encodings-for-Input-and-Output" accesskey="7">perlunicode Character Encodings for Input and Output</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Unicode-Regular-Expression-Support-Level" accesskey="8">perlunicode Unicode Regular Expression Support Level</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Unicode-Encodings" accesskey="9">perlunicode Unicode Encodings</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Non_002dcharacter-code-points">perlunicode Non-character code points</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Beyond-Unicode-code-points">perlunicode Beyond Unicode code points</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Security-Implications-of-Unicode">perlunicode Security Implications of Unicode</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Unicode-in-Perl-on-EBCDIC">perlunicode Unicode in Perl on EBCDIC</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Locales">perlunicode Locales</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-When-Unicode-Does-Not-Happen">perlunicode When Unicode Does Not Happen</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-The-_0022Unicode-Bug_0022">perlunicode The &quot;Unicode Bug&quot;</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Forcing-Unicode-in-Perl-_0028Or-Unforcing-Unicode-in-Perl_0029">perlunicode Forcing Unicode in Perl (Or Unforcing Unicode in Perl)</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Using-Unicode-in-XS">perlunicode Using Unicode in XS</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Hacking-Perl-to-work-on-earlier-Unicode-versions-_0028for-very-serious-hackers-only_0029">perlunicode Hacking Perl to work on earlier Unicode versions (for very serious hackers only)</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="perlunicode-Important-Caveats"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Byte-and-Character-Semantics" accesskey="n" rel="next">perlunicode Byte and Character Semantics</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Important-Caveats"></a>
<h4 class="subsection">80.2.1 Important Caveats</h4>

<p>Unicode support is an extensive requirement. While Perl does not
implement the Unicode standard or the accompanying technical reports
from cover to cover, Perl does support many Unicode features.
</p>
<p>People who want to learn to use Unicode in Perl, should probably read
the <a href="perlunitut.html#perlunitut-NAME">Perl Unicode tutorial, perlunitut</a> and
<a href="perluniintro.html#perluniintro-NAME">perluniintro NAME</a>, before reading
this reference document.
</p>
<p>Also, the use of Unicode may present security issues that aren&rsquo;t obvious.
Read <a href="http://www.unicode.org/reports/tr36">Unicode Security Considerations</a>.
</p>
<dl compact="compact">
<dt>Safest if you &quot;use feature &rsquo;unicode_strings&rsquo;&quot;</dt>
<dd><a name="perlunicode-Safest-if-you-_0022use-feature-_0027unicode_005fstrings_0027_0022"></a>
<p>In order to preserve backward compatibility, Perl does not turn
on full internal Unicode support unless the pragma
<code>use feature 'unicode_strings'</code> is specified.  (This is automatically
selected if you use <code>use 5.012</code> or higher.)  Failure to do this can
trigger unexpected surprises.  See <a href="#perlunicode-The-_0022Unicode-Bug_0022">The &quot;Unicode Bug&quot;</a> below.
</p>
<p>This pragma doesn&rsquo;t affect I/O.  Nor does it change the internal
representation of strings, only their interpretation.  There are still
several places where Unicode isn&rsquo;t fully supported, such as in
filenames.
</p>
</dd>
<dt>Input and Output Layers</dt>
<dd><a name="perlunicode-Input-and-Output-Layers"></a>
<p>Perl knows when a filehandle uses Perl&rsquo;s internal Unicode encodings
(UTF-8, or UTF-EBCDIC if in EBCDIC) if the filehandle is opened with
the &quot;:encoding(utf8)&quot; layer.  Other encodings can be converted to Perl&rsquo;s
encoding on input or from Perl&rsquo;s encoding on output by use of the
&quot;:encoding(...)&quot;  layer.  See <a href="../open/index.html">(open)</a>.
</p>
<p>To indicate that Perl source itself is in UTF-8, use <code>use utf8;</code>.
</p>
</dd>
<dt><code>use utf8</code> still needed to enable UTF-8/UTF-EBCDIC in scripts</dt>
<dd><a name="perlunicode-use-utf8-still-needed-to-enable-UTF_002d8_002fUTF_002dEBCDIC-in-scripts"></a>
<p>As a compatibility measure, the <code>use utf8</code> pragma must be explicitly
included to enable recognition of UTF-8 in the Perl scripts themselves
(in string or regular expression literals, or in identifier names) on
ASCII-based machines or to recognize UTF-EBCDIC on EBCDIC-based
machines.  <strong>These are the only times when an explicit <code>use utf8</code>
is needed.</strong>  See <a href="../utf8/index.html">(utf8)</a>.
</p>
</dd>
<dt>BOM-marked scripts and UTF-16 scripts autodetected</dt>
<dd><a name="perlunicode-BOM_002dmarked-scripts-and-UTF_002d16-scripts-autodetected"></a>
<p>If a Perl script begins marked with the Unicode BOM (UTF-16LE, UTF16-BE,
or UTF-8), or if the script looks like non-BOM-marked UTF-16 of either
endianness, Perl will correctly read in the script as Unicode.
(BOMless UTF-8 cannot be effectively recognized or differentiated from
ISO 8859-1 or other eight-bit encodings.)
</p>
</dd>
<dt><code>use encoding</code> needed to upgrade non-Latin-1 byte strings</dt>
<dd><a name="perlunicode-use-encoding-needed-to-upgrade-non_002dLatin_002d1-byte-strings"></a>
<p>By default, there is a fundamental asymmetry in Perl&rsquo;s Unicode model:
implicit upgrading from byte strings to Unicode strings assumes that
they were encoded in <em>ISO 8859-1 (Latin-1)</em>, but Unicode strings are
downgraded with UTF-8 encoding.  This happens because the first 256
codepoints in Unicode happens to agree with Latin-1.
</p>
<p>See <a href="#perlunicode-Byte-and-Character-Semantics">Byte and Character Semantics</a> for more details.
</p>
</dd>
</dl>

<hr>
<a name="perlunicode-Byte-and-Character-Semantics"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Effects-of-Character-Semantics" accesskey="n" rel="next">perlunicode Effects of Character Semantics</a>, Previous: <a href="#perlunicode-Important-Caveats" accesskey="p" rel="prev">perlunicode Important Caveats</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Byte-and-Character-Semantics"></a>
<h4 class="subsection">80.2.2 Byte and Character Semantics</h4>

<p>Perl uses logically-wide characters to represent strings internally.
</p>
<p>Starting in Perl 5.14, Perl-level operations work with
characters rather than bytes within the scope of a
<code><a href="../feature/index.html">(feature)use feature 'unicode_strings'</a></code> (or equivalently
<code>use 5.012</code> or higher).  (This is not true if bytes have been
explicitly requested by <code><a href="../bytes/index.html">(bytes)use bytes</a></code>, nor necessarily true
for interactions with the platform&rsquo;s operating system.)
</p>
<p>For earlier Perls, and when <code>unicode_strings</code> is not in effect, Perl
provides a fairly safe environment that can handle both types of
semantics in programs.  For operations where Perl can unambiguously
decide that the input data are characters, Perl switches to character
semantics.  For operations where this determination cannot be made
without additional information from the user, Perl decides in favor of
compatibility and chooses to use byte semantics.
</p>
<p>When <code>use locale</code> (but not <code>use locale ':not_characters'</code>) is in
effect, Perl uses the semantics associated with the current locale.
(<code>use locale</code> overrides <code>use feature 'unicode_strings'</code> in the same scope;
while <code>use locale ':not_characters'</code> effectively also selects
<code>use feature 'unicode_strings'</code> in its scope; see <a href="perllocale.html#perllocale-NAME">perllocale NAME</a>.)
Otherwise, Perl uses the platform&rsquo;s native
byte semantics for characters whose code points are less than 256, and
Unicode semantics for those greater than 255.  That means that non-ASCII
characters are undefined except for their
ordinal numbers.  This means that none have case (upper and lower), nor are any
a member of character classes, like <code>[:alpha:]</code> or <code>\w</code>.  (But all do belong
to the <code>\W</code> class or the Perl regular expression extension <code>[:^alpha:]</code>.)
</p>
<p>This behavior preserves compatibility with earlier versions of Perl,
which allowed byte semantics in Perl operations only if
none of the program&rsquo;s inputs were marked as being a source of Unicode
character data.  Such data may come from filehandles, from calls to
external programs, from information provided by the system (such as %ENV),
or from literals and constants in the source text.
</p>
<p>The <code>utf8</code> pragma is primarily a compatibility device that enables
recognition of UTF-(8|EBCDIC) in literals encountered by the parser.
Note that this pragma is only required while Perl defaults to byte
semantics; when character semantics become the default, this pragma
may become a no-op.  See <a href="../utf8/index.html">(utf8)</a>.
</p>
<p>If strings operating under byte semantics and strings with Unicode
character data are concatenated, the new string will have
character semantics.  This can cause surprises: See <a href="#perlunicode-BUGS">BUGS</a>, below.
You can choose to be warned when this happens.  See <a href="../encoding-warnings/index.html">(encoding-warnings)</a>.
</p>
<p>Under character semantics, many operations that formerly operated on
bytes now operate on characters. A character in Perl is
logically just a number ranging from 0 to 2**31 or so. Larger
characters may encode into longer sequences of bytes internally, but
this internal detail is mostly hidden for Perl code.
See <a href="perluniintro.html#perluniintro-NAME">perluniintro NAME</a> for more.
</p>
<hr>
<a name="perlunicode-Effects-of-Character-Semantics"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Unicode-Character-Properties" accesskey="n" rel="next">perlunicode Unicode Character Properties</a>, Previous: <a href="#perlunicode-Byte-and-Character-Semantics" accesskey="p" rel="prev">perlunicode Byte and Character Semantics</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Effects-of-Character-Semantics"></a>
<h4 class="subsection">80.2.3 Effects of Character Semantics</h4>

<p>Character semantics have the following effects:
</p>
<ul>
<li> Strings&ndash;including hash keys&ndash;and regular expression patterns may
contain characters that have an ordinal value larger than 255.

<p>If you use a Unicode editor to edit your program, Unicode characters may
occur directly within the literal strings in UTF-8 encoding, or UTF-16.
(The former requires a BOM or <code>use utf8</code>, the latter requires a BOM.)
</p>
<p>Unicode characters can also be added to a string by using the <code>\N{U+...}</code>
notation.  The Unicode code for the desired character, in hexadecimal,
should be placed in the braces, after the <code>U</code>. For instance, a smiley face is
<code>\N{U+263A}</code>.
</p>
<p>Alternatively, you can use the <code>\x{...}</code> notation for characters 0x100 and
above.  For characters below 0x100 you may get byte semantics instead of
character semantics;  see <a href="#perlunicode-The-_0022Unicode-Bug_0022">The &quot;Unicode Bug&quot;</a>.  On EBCDIC machines there is
the additional problem that the value for such characters gives the EBCDIC
character rather than the Unicode one, thus it is more portable to use
<code>\N{U+...}</code> instead.
</p>
<p>Additionally, you can use the <code>\N{...}</code> notation and put the official
Unicode character name within the braces, such as
<code>\N{WHITE SMILING FACE}</code>.  This automatically loads the <a href="../charnames/index.html">(charnames)</a>
module with the <code>:full</code> and <code>:short</code> options.  If you prefer different
options for this module, you can instead, before the <code>\N{...}</code>,
explicitly load it with your desired options; for example,
</p>
<pre class="verbatim">   use charnames ':loose';
</pre>
</li><li> If an appropriate <a href="../encoding/index.html">(encoding)</a> is specified, identifiers within the
Perl script may contain Unicode alphanumeric characters, including
ideographs.  Perl does not currently attempt to canonicalize variable
names.

</li><li> Regular expressions match characters instead of bytes.  &quot;.&quot; matches
a character instead of a byte.

</li><li> Bracketed character classes in regular expressions match characters instead of
bytes and match against the character properties specified in the
Unicode properties database.  <code>\w</code> can be used to match a Japanese
ideograph, for instance.

</li><li> Named Unicode properties, scripts, and block ranges may be used (like bracketed
character classes) by using the <code>\p{}</code> &quot;matches property&quot; construct and
the <code>\P{}</code> negation, &quot;doesn&rsquo;t match property&quot;.
See <a href="#perlunicode-Unicode-Character-Properties">Unicode Character Properties</a> for more details.

<p>You can define your own character properties and use them
in the regular expression with the <code>\p{}</code> or <code>\P{}</code> construct.
See <a href="#perlunicode-User_002dDefined-Character-Properties">User-Defined Character Properties</a> for more details.
</p>
</li><li> The special pattern <code>\X</code> matches a logical character, an &quot;extended grapheme
cluster&quot; in Standardese.  In Unicode what appears to the user to be a single
character, for example an accented <code>G</code>, may in fact be composed of a sequence
of characters, in this case a <code>G</code> followed by an accent character.  <code>\X</code>
will match the entire sequence.

</li><li> The <code>tr///</code> operator translates characters instead of bytes.  Note
that the <code>tr///CU</code> functionality has been removed.  For similar
functionality see pack(&rsquo;U0&rsquo;, ...) and pack(&rsquo;C0&rsquo;, ...).

</li><li> Case translation operators use the Unicode case translation tables
when character input is provided.  Note that <code>uc()</code>, or <code>\U</code> in
interpolated strings, translates to uppercase, while <code>ucfirst</code>,
or <code>\u</code> in interpolated strings, translates to titlecase in languages
that make the distinction (which is equivalent to uppercase in languages
without the distinction).

</li><li> Most operators that deal with positions or lengths in a string will
automatically switch to using character positions, including
<code>chop()</code>, <code>chomp()</code>, <code>substr()</code>, <code>pos()</code>, <code>index()</code>, <code>rindex()</code>,
<code>sprintf()</code>, <code>write()</code>, and <code>length()</code>.  An operator that
specifically does not switch is <code>vec()</code>.  Operators that really don&rsquo;t
care include operators that treat strings as a bucket of bits such as
<code>sort()</code>, and operators dealing with filenames.

</li><li> The <code>pack()</code>/<code>unpack()</code> letter <code>C</code> does <em>not</em> change, since it is often
used for byte-oriented formats.  Again, think <code>char</code> in the C language.

<p>There is a new <code>U</code> specifier that converts between Unicode characters
and code points. There is also a <code>W</code> specifier that is the equivalent of
<code>chr</code>/<code>ord</code> and properly handles character values even if they are above 255.
</p>
</li><li> The <code>chr()</code> and <code>ord()</code> functions work on characters, similar to
<code>pack(&quot;W&quot;)</code> and <code>unpack(&quot;W&quot;)</code>, <em>not</em> <code>pack(&quot;C&quot;)</code> and
<code>unpack(&quot;C&quot;)</code>.  <code>pack(&quot;C&quot;)</code> and <code>unpack(&quot;C&quot;)</code> are methods for
emulating byte-oriented <code>chr()</code> and <code>ord()</code> on Unicode strings.
While these methods reveal the internal encoding of Unicode strings,
that is not something one normally needs to care about at all.

</li><li> The bit string operators, <code>&amp; | ^ ~</code>, can operate on character data.
However, for backward compatibility, such as when using bit string
operations when characters are all less than 256 in ordinal value, one
should not use <code>~</code> (the bit complement) with characters of both
values less than 256 and values greater than 256.  Most importantly,
DeMorgan&rsquo;s laws (<code>~($x|$y) eq ~$x&amp;~$y</code> and <code>~($x&amp;$y) eq ~$x|~$y</code>)
will not hold.  The reason for this mathematical <em>faux pas</em> is that
the complement cannot return <strong>both</strong> the 8-bit (byte-wide) bit
complement <strong>and</strong> the full character-wide bit complement.

</li><li> There is a CPAN module, <a href="../Unicode-Casing/index.html">(Unicode-Casing)</a>, which allows you to define
your own mappings to be used in <code>lc()</code>, <code>lcfirst()</code>, <code>uc()</code>,
<code>ucfirst()</code>, and <code>fc</code> (or their double-quoted string inlined
versions such as <code>\U</code>).
(Prior to Perl 5.16, this functionality was partially provided
in the Perl core, but suffered from a number of insurmountable
drawbacks, so the CPAN module was written instead.)

</li></ul>

<ul>
<li> And finally, <code>scalar reverse()</code> reverses by character rather than by byte.

</li></ul>

<hr>
<a name="perlunicode-Unicode-Character-Properties"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-User_002dDefined-Character-Properties" accesskey="n" rel="next">perlunicode User-Defined Character Properties</a>, Previous: <a href="#perlunicode-Effects-of-Character-Semantics" accesskey="p" rel="prev">perlunicode Effects of Character Semantics</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Unicode-Character-Properties"></a>
<h4 class="subsection">80.2.4 Unicode Character Properties</h4>

<p>(The only time that Perl considers a sequence of individual code
points as a single logical character is in the <code>\X</code> construct, already
mentioned above.   Therefore &quot;character&quot; in this discussion means a single
Unicode code point.)
</p>
<p>Very nearly all Unicode character properties are accessible through
regular expressions by using the <code>\p{}</code> &quot;matches property&quot; construct
and the <code>\P{}</code> &quot;doesn&rsquo;t match property&quot; for its negation.
</p>
<p>For instance, <code>\p{Uppercase}</code> matches any single character with the Unicode
&quot;Uppercase&quot; property, while <code>\p{L}</code> matches any character with a
General_Category of &quot;L&quot; (letter) property.  Brackets are not
required for single letter property names, so <code>\p{L}</code> is equivalent to <code>\pL</code>.
</p>
<p>More formally, <code>\p{Uppercase}</code> matches any single character whose Unicode
Uppercase property value is True, and <code>\P{Uppercase}</code> matches any character
whose Uppercase property value is False, and they could have been written as
<code>\p{Uppercase=True}</code> and <code>\p{Uppercase=False}</code>, respectively.
</p>
<p>This formality is needed when properties are not binary; that is, if they can
take on more values than just True and False.  For example, the Bidi_Class (see
<a href="#perlunicode-Bidirectional-Character-Types">Bidirectional Character Types</a> below), can take on several different
values, such as Left, Right, Whitespace, and others.  To match these, one needs
to specify both the property name (Bidi_Class), AND the value being
matched against
(Left, Right, etc.).  This is done, as in the examples above, by having the
two components separated by an equal sign (or interchangeably, a colon), like
<code>\p{Bidi_Class: Left}</code>.
</p>
<p>All Unicode-defined character properties may be written in these compound forms
of <code>\p{property=value}</code> or <code>\p{property:value}</code>, but Perl provides some
additional properties that are written only in the single form, as well as
single-form short-cuts for all binary properties and certain others described
below, in which you may omit the property name and the equals or colon
separator.
</p>
<p>Most Unicode character properties have at least two synonyms (or aliases if you
prefer): a short one that is easier to type and a longer one that is more
descriptive and hence easier to understand.  Thus the &quot;L&quot; and &quot;Letter&quot; properties
above are equivalent and can be used interchangeably.  Likewise,
&quot;Upper&quot; is a synonym for &quot;Uppercase&quot;, and we could have written
<code>\p{Uppercase}</code> equivalently as <code>\p{Upper}</code>.  Also, there are typically
various synonyms for the values the property can be.   For binary properties,
&quot;True&quot; has 3 synonyms: &quot;T&quot;, &quot;Yes&quot;, and &quot;Y&quot;; and &quot;False has correspondingly &quot;F&quot;,
&quot;No&quot;, and &quot;N&quot;.  But be careful.  A short form of a value for one property may
not mean the same thing as the same short form for another.  Thus, for the
General_Category property, &quot;L&quot; means &quot;Letter&quot;, but for the Bidi_Class property,
&quot;L&quot; means &quot;Left&quot;.  A complete list of properties and synonyms is in
<a href="../perluniprops/index.html">(perluniprops)</a>.
</p>
<p>Upper/lower case differences in property names and values are irrelevant;
thus <code>\p{Upper}</code> means the same thing as <code>\p{upper}</code> or even <code>\p{UpPeR}</code>.
Similarly, you can add or subtract underscores anywhere in the middle of a
word, so that these are also equivalent to <code>\p{U_p_p_e_r}</code>.  And white space
is irrelevant adjacent to non-word characters, such as the braces and the equals
or colon separators, so <code>\p{   Upper  }</code> and <code>\p{ Upper_case : Y }</code> are
equivalent to these as well.  In fact, white space and even
hyphens can usually be added or deleted anywhere.  So even <code>\p{ Up-per case = Yes}</code> is
equivalent.  All this is called &quot;loose-matching&quot; by Unicode.  The few places
where stricter matching is used is in the middle of numbers, and in the Perl
extension properties that begin or end with an underscore.  Stricter matching
cares about white space (except adjacent to non-word characters),
hyphens, and non-interior underscores.
</p>
<p>You can also use negation in both <code>\p{}</code> and <code>\P{}</code> by introducing a caret
(^) between the first brace and the property name: <code>\p{^Tamil}</code> is
equal to <code>\P{Tamil}</code>.
</p>
<p>Almost all properties are immune to case-insensitive matching.  That is,
adding a <code>/i</code> regular expression modifier does not change what they
match.  There are two sets that are affected.
The first set is
<code>Uppercase_Letter</code>,
<code>Lowercase_Letter</code>,
and <code>Titlecase_Letter</code>,
all of which match <code>Cased_Letter</code> under <code>/i</code> matching.
And the second set is
<code>Uppercase</code>,
<code>Lowercase</code>,
and <code>Titlecase</code>,
all of which match <code>Cased</code> under <code>/i</code> matching.
This set also includes its subsets <code>PosixUpper</code> and <code>PosixLower</code> both
of which under <code>/i</code> matching match <code>PosixAlpha</code>.
(The difference between these sets is that some things, such as Roman
numerals, come in both upper and lower case so they are <code>Cased</code>, but aren&rsquo;t considered
letters, so they aren&rsquo;t <code>Cased_Letter</code>s.)
</p>
<p>The result is undefined if you try to match a non-Unicode code point
(that is, one above 0x10FFFF) against a Unicode property.  Currently, a
warning is raised, and the match will fail.  In some cases, this is
counterintuitive, as both these fail:
</p>
<pre class="verbatim"> chr(0x110000) =~ \p{ASCII_Hex_Digit=True}      # Fails.
 chr(0x110000) =~ \p{ASCII_Hex_Digit=False}     # Fails!
</pre>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-General_005fCategory" accesskey="1">perlunicode <strong>General_Category</strong></a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Bidirectional-Character-Types" accesskey="2">perlunicode <strong>Bidirectional Character Types</strong></a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Scripts" accesskey="3">perlunicode <strong>Scripts</strong></a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Use-of-_0022Is_0022-Prefix" accesskey="4">perlunicode <strong>Use of &quot;Is&quot; Prefix</strong></a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Blocks" accesskey="5">perlunicode <strong>Blocks</strong></a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Other-Properties" accesskey="6">perlunicode <strong>Other Properties</strong></a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="perlunicode-General_005fCategory"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Bidirectional-Character-Types" accesskey="n" rel="next">perlunicode <strong>Bidirectional Character Types</strong></a>, Up: <a href="#perlunicode-Unicode-Character-Properties" accesskey="u" rel="up">perlunicode Unicode Character Properties</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="General_005fCategory"></a>
<h4 class="subsubsection">80.2.4.1 <strong>General_Category</strong></h4>

<p>Every Unicode character is assigned a general category, which is the &quot;most
usual categorization of a character&quot; (from
<a href="http://www.unicode.org/reports/tr44">http://www.unicode.org/reports/tr44</a>).
</p>
<p>The compound way of writing these is like <code>\p{General_Category=Number}</code>
(short, <code>\p{gc:n}</code>).  But Perl furnishes shortcuts in which everything up
through the equal or colon separator is omitted.  So you can instead just write
<code>\pN</code>.
</p>
<p>Here are the short and long forms of the General Category properties:
</p>
<pre class="verbatim">    Short       Long

    L           Letter
    LC, L&amp;      Cased_Letter (that is: [\p{Ll}\p{Lu}\p{Lt}])
    Lu          Uppercase_Letter
    Ll          Lowercase_Letter
    Lt          Titlecase_Letter
    Lm          Modifier_Letter
    Lo          Other_Letter

    M           Mark
    Mn          Nonspacing_Mark
    Mc          Spacing_Mark
    Me          Enclosing_Mark

    N           Number
    Nd          Decimal_Number (also Digit)
    Nl          Letter_Number
    No          Other_Number

    P           Punctuation (also Punct)
    Pc          Connector_Punctuation
    Pd          Dash_Punctuation
    Ps          Open_Punctuation
    Pe          Close_Punctuation
    Pi          Initial_Punctuation
                (may behave like Ps or Pe depending on usage)
    Pf          Final_Punctuation
                (may behave like Ps or Pe depending on usage)
    Po          Other_Punctuation

    S           Symbol
    Sm          Math_Symbol
    Sc          Currency_Symbol
    Sk          Modifier_Symbol
    So          Other_Symbol

    Z           Separator
    Zs          Space_Separator
    Zl          Line_Separator
    Zp          Paragraph_Separator

    C           Other
    Cc          Control (also Cntrl)
    Cf          Format
    Cs          Surrogate
    Co          Private_Use
    Cn          Unassigned
</pre>
<p>Single-letter properties match all characters in any of the
two-letter sub-properties starting with the same letter.
<code>LC</code> and <code>L&amp;</code> are special: both are aliases for the set consisting of everything matched by <code>Ll</code>, <code>Lu</code>, and <code>Lt</code>.
</p>
<hr>
<a name="perlunicode-Bidirectional-Character-Types"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Scripts" accesskey="n" rel="next">perlunicode <strong>Scripts</strong></a>, Previous: <a href="#perlunicode-General_005fCategory" accesskey="p" rel="prev">perlunicode <strong>General_Category</strong></a>, Up: <a href="#perlunicode-Unicode-Character-Properties" accesskey="u" rel="up">perlunicode Unicode Character Properties</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Bidirectional-Character-Types"></a>
<h4 class="subsubsection">80.2.4.2 <strong>Bidirectional Character Types</strong></h4>

<p>Because scripts differ in their directionality (Hebrew and Arabic are
written right to left, for example) Unicode supplies these properties in
the Bidi_Class class:
</p>
<pre class="verbatim">    Property    Meaning

    L           Left-to-Right
    LRE         Left-to-Right Embedding
    LRO         Left-to-Right Override
    R           Right-to-Left
    AL          Arabic Letter
    RLE         Right-to-Left Embedding
    RLO         Right-to-Left Override
    PDF         Pop Directional Format
    EN          European Number
    ES          European Separator
    ET          European Terminator
    AN          Arabic Number
    CS          Common Separator
    NSM         Non-Spacing Mark
    BN          Boundary Neutral
    B           Paragraph Separator
    S           Segment Separator
    WS          Whitespace
    ON          Other Neutrals
</pre>
<p>This property is always written in the compound form.
For example, <code>\p{Bidi_Class:R}</code> matches characters that are normally
written right to left.
</p>
<hr>
<a name="perlunicode-Scripts"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Use-of-_0022Is_0022-Prefix" accesskey="n" rel="next">perlunicode <strong>Use of &quot;Is&quot; Prefix</strong></a>, Previous: <a href="#perlunicode-Bidirectional-Character-Types" accesskey="p" rel="prev">perlunicode <strong>Bidirectional Character Types</strong></a>, Up: <a href="#perlunicode-Unicode-Character-Properties" accesskey="u" rel="up">perlunicode Unicode Character Properties</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Scripts"></a>
<h4 class="subsubsection">80.2.4.3 <strong>Scripts</strong></h4>

<p>The world&rsquo;s languages are written in many different scripts.  This sentence
(unless you&rsquo;re reading it in translation) is written in Latin, while Russian is
written in Cyrillic, and Greek is written in, well, Greek; Japanese mainly in
Hiragana or Katakana.  There are many more.
</p>
<p>The Unicode Script and Script_Extensions properties give what script a
given character is in.  Either property can be specified with the
compound form like
<code>\p{Script=Hebrew}</code> (short: <code>\p{sc=hebr}</code>), or
<code>\p{Script_Extensions=Javanese}</code> (short: <code>\p{scx=java}</code>).
In addition, Perl furnishes shortcuts for all
<code>Script</code> property names.  You can omit everything up through the equals
(or colon), and simply write <code>\p{Latin}</code> or <code>\P{Cyrillic}</code>.
(This is not true for <code>Script_Extensions</code>, which is required to be
written in the compound form.)
</p>
<p>The difference between these two properties involves characters that are
used in multiple scripts.  For example the digits &rsquo;0&rsquo; through &rsquo;9&rsquo; are
used in many parts of the world.  These are placed in a script named
<code>Common</code>.  Other characters are used in just a few scripts.  For
example, the &quot;KATAKANA-HIRAGANA DOUBLE HYPHEN&quot; is used in both Japanese
scripts, Katakana and Hiragana, but nowhere else.  The <code>Script</code>
property places all characters that are used in multiple scripts in the
<code>Common</code> script, while the <code>Script_Extensions</code> property places those
that are used in only a few scripts into each of those scripts; while
still using <code>Common</code> for those used in many scripts.  Thus both these
match:
</p>
<pre class="verbatim"> &quot;0&quot; =~ /\p{sc=Common}/     # Matches
 &quot;0&quot; =~ /\p{scx=Common}/    # Matches
</pre>
<p>and only the first of these match:
</p>
<pre class="verbatim"> &quot;\N{KATAKANA-HIRAGANA DOUBLE HYPHEN}&quot; =~ /\p{sc=Common}  # Matches
 &quot;\N{KATAKANA-HIRAGANA DOUBLE HYPHEN}&quot; =~ /\p{scx=Common} # No match
</pre>
<p>And only the last two of these match:
</p>
<pre class="verbatim"> &quot;\N{KATAKANA-HIRAGANA DOUBLE HYPHEN}&quot; =~ /\p{sc=Hiragana}  # No match
 &quot;\N{KATAKANA-HIRAGANA DOUBLE HYPHEN}&quot; =~ /\p{sc=Katakana}  # No match
 &quot;\N{KATAKANA-HIRAGANA DOUBLE HYPHEN}&quot; =~ /\p{scx=Hiragana} # Matches
 &quot;\N{KATAKANA-HIRAGANA DOUBLE HYPHEN}&quot; =~ /\p{scx=Katakana} # Matches
</pre>
<p><code>Script_Extensions</code> is thus an improved <code>Script</code>, in which there are
fewer characters in the <code>Common</code> script, and correspondingly more in
other scripts.  It is new in Unicode version 6.0, and its data are likely
to change significantly in later releases, as things get sorted out.
</p>
<p>(Actually, besides <code>Common</code>, the <code>Inherited</code> script, contains
characters that are used in multiple scripts.  These are modifier
characters which modify other characters, and inherit the script value
of the controlling character.  Some of these are used in many scripts,
and so go into <code>Inherited</code> in both <code>Script</code> and <code>Script_Extensions</code>.
Others are used in just a few scripts, so are in <code>Inherited</code> in
<code>Script</code>, but not in <code>Script_Extensions</code>.)
</p>
<p>It is worth stressing that there are several different sets of digits in
Unicode that are equivalent to 0-9 and are matchable by <code>\d</code> in a
regular expression.  If they are used in a single language only, they
are in that language&rsquo;s <code>Script</code> and <code>Script_Extension</code>.  If they are
used in more than one script, they will be in <code>sc=Common</code>, but only
if they are used in many scripts should they be in <code>scx=Common</code>.
</p>
<p>A complete list of scripts and their shortcuts is in <a href="../perluniprops/index.html">(perluniprops)</a>.
</p>
<hr>
<a name="perlunicode-Use-of-_0022Is_0022-Prefix"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Blocks" accesskey="n" rel="next">perlunicode <strong>Blocks</strong></a>, Previous: <a href="#perlunicode-Scripts" accesskey="p" rel="prev">perlunicode <strong>Scripts</strong></a>, Up: <a href="#perlunicode-Unicode-Character-Properties" accesskey="u" rel="up">perlunicode Unicode Character Properties</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Use-of-_0022Is_0022-Prefix"></a>
<h4 class="subsubsection">80.2.4.4 <strong>Use of &quot;Is&quot; Prefix</strong></h4>

<p>For backward compatibility (with Perl 5.6), all properties mentioned
so far may have <code>Is</code> or <code>Is_</code> prepended to their name, so <code>\P{Is_Lu}</code>, for
example, is equal to <code>\P{Lu}</code>, and <code>\p{IsScript:Arabic}</code> is equal to
<code>\p{Arabic}</code>.
</p>
<hr>
<a name="perlunicode-Blocks"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Other-Properties" accesskey="n" rel="next">perlunicode <strong>Other Properties</strong></a>, Previous: <a href="#perlunicode-Use-of-_0022Is_0022-Prefix" accesskey="p" rel="prev">perlunicode <strong>Use of &quot;Is&quot; Prefix</strong></a>, Up: <a href="#perlunicode-Unicode-Character-Properties" accesskey="u" rel="up">perlunicode Unicode Character Properties</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Blocks"></a>
<h4 class="subsubsection">80.2.4.5 <strong>Blocks</strong></h4>

<p>In addition to <strong>scripts</strong>, Unicode also defines <strong>blocks</strong> of
characters.  The difference between scripts and blocks is that the
concept of scripts is closer to natural languages, while the concept
of blocks is more of an artificial grouping based on groups of Unicode
characters with consecutive ordinal values. For example, the &quot;Basic Latin&quot;
block is all characters whose ordinals are between 0 and 127, inclusive; in
other words, the ASCII characters.  The &quot;Latin&quot; script contains some letters
from this as well as several other blocks, like &quot;Latin-1 Supplement&quot;,
&quot;Latin Extended-A&quot;, etc., but it does not contain all the characters from
those blocks. It does not, for example, contain the digits 0-9, because
those digits are shared across many scripts, and hence are in the
<code>Common</code> script.
</p>
<p>For more about scripts versus blocks, see UAX#24 &quot;Unicode Script Property&quot;:
<a href="http://www.unicode.org/reports/tr24">http://www.unicode.org/reports/tr24</a>
</p>
<p>The <code>Script</code> or <code>Script_Extensions</code> properties are likely to be the
ones you want to use when processing
natural language; the Block property may occasionally be useful in working
with the nuts and bolts of Unicode.
</p>
<p>Block names are matched in the compound form, like <code>\p{Block: Arrows}</code> or
<code>\p{Blk=Hebrew}</code>.  Unlike most other properties, only a few block names have a
Unicode-defined short name.  But Perl does provide a (slight) shortcut:  You
can say, for example <code>\p{In_Arrows}</code> or <code>\p{In_Hebrew}</code>.  For backwards
compatibility, the <code>In</code> prefix may be omitted if there is no naming conflict
with a script or any other property, and you can even use an <code>Is</code> prefix
instead in those cases.  But it is not a good idea to do this, for a couple
reasons:
</p>
<ol>
<li> It is confusing.  There are many naming conflicts, and you may forget some.
For example, <code>\p{Hebrew}</code> means the <em>script</em> Hebrew, and NOT the <em>block</em>
Hebrew.  But would you remember that 6 months from now?

</li><li> It is unstable.  A new version of Unicode may pre-empt the current meaning by
creating a property with the same name.  There was a time in very early Unicode
releases when <code>\p{Hebrew}</code> would have matched the <em>block</em> Hebrew; now it
doesn&rsquo;t.

</li></ol>

<p>Some people prefer to always use <code>\p{Block: foo}</code> and <code>\p{Script: bar}</code>
instead of the shortcuts, whether for clarity, because they can&rsquo;t remember the
difference between &rsquo;In&rsquo; and &rsquo;Is&rsquo; anyway, or they aren&rsquo;t confident that those who
eventually will read their code will know that difference.
</p>
<p>A complete list of blocks and their shortcuts is in <a href="../perluniprops/index.html">(perluniprops)</a>.
</p>
<hr>
<a name="perlunicode-Other-Properties"></a>
<div class="header">
<p>
Previous: <a href="#perlunicode-Blocks" accesskey="p" rel="prev">perlunicode <strong>Blocks</strong></a>, Up: <a href="#perlunicode-Unicode-Character-Properties" accesskey="u" rel="up">perlunicode Unicode Character Properties</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Other-Properties"></a>
<h4 class="subsubsection">80.2.4.6 <strong>Other Properties</strong></h4>

<p>There are many more properties than the very basic ones described here.
A complete list is in <a href="../perluniprops/index.html">(perluniprops)</a>.
</p>
<p>Unicode defines all its properties in the compound form, so all single-form
properties are Perl extensions.  Most of these are just synonyms for the
Unicode ones, but some are genuine extensions, including several that are in
the compound form.  And quite a few of these are actually recommended by Unicode
(in <a href="http://www.unicode.org/reports/tr18">http://www.unicode.org/reports/tr18</a>).
</p>
<p>This section gives some details on all extensions that aren&rsquo;t just
synonyms for compound-form Unicode properties
(for those properties, you&rsquo;ll have to refer to the
<a href="http://www.unicode.org/reports/tr44">Unicode Standard</a>.
</p>
<dl compact="compact">
<dt><strong><code>\p{All}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bAll_007d"></a>
<p>This matches any of the 1_114_112 Unicode code points.  It is a synonym for
<code>\p{Any}</code>.
</p>
</dd>
<dt><strong><code>\p{Alnum}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bAlnum_007d"></a>
<p>This matches any <code>\p{Alphabetic}</code> or <code>\p{Decimal_Number}</code> character.
</p>
</dd>
<dt><strong><code>\p{Any}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bAny_007d"></a>
<p>This matches any of the 1_114_112 Unicode code points.  It is a synonym for
<code>\p{All}</code>.
</p>
</dd>
<dt><strong><code>\p{ASCII}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bASCII_007d"></a>
<p>This matches any of the 128 characters in the US-ASCII character set,
which is a subset of Unicode.
</p>
</dd>
<dt><strong><code>\p{Assigned}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bAssigned_007d"></a>
<p>This matches any assigned code point; that is, any code point whose general
category is not Unassigned (or equivalently, not Cn).
</p>
</dd>
<dt><strong><code>\p{Blank}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bBlank_007d"></a>
<p>This is the same as <code>\h</code> and <code>\p{HorizSpace}</code>:  A character that changes the
spacing horizontally.
</p>
</dd>
<dt><strong><code>\p{Decomposition_Type: Non_Canonical}</code></strong>    (Short: <code>\p{Dt=NonCanon}</code>)</dt>
<dd><a name="perlunicode-_005cp_007bDecomposition_005fType_003a-Non_005fCanonical_007d-_0028Short_003a-_005cp_007bDt_003dNonCanon_007d_0029"></a>
<p>Matches a character that has a non-canonical decomposition.
</p>
<p>To understand the use of this rarely used property=value combination, it is
necessary to know some basics about decomposition.
Consider a character, say H.  It could appear with various marks around it,
such as an acute accent, or a circumflex, or various hooks, circles, arrows,
<em>etc.</em>, above, below, to one side or the other, etc.  There are many
possibilities among the world&rsquo;s languages.  The number of combinations is
astronomical, and if there were a character for each combination, it would
soon exhaust Unicode&rsquo;s more than a million possible characters.  So Unicode
took a different approach: there is a character for the base H, and a
character for each of the possible marks, and these can be variously combined
to get a final logical character.  So a logical character&ndash;what appears to be a
single character&ndash;can be a sequence of more than one individual characters.
This is called an &quot;extended grapheme cluster&quot;;  Perl furnishes the <code>\X</code>
regular expression construct to match such sequences.
</p>
<p>But Unicode&rsquo;s intent is to unify the existing character set standards and
practices, and several pre-existing standards have single characters that
mean the same thing as some of these combinations.  An example is ISO-8859-1,
which has quite a few of these in the Latin-1 range, an example being &quot;LATIN
CAPITAL LETTER E WITH ACUTE&quot;.  Because this character was in this pre-existing
standard, Unicode added it to its repertoire.  But this character is considered
by Unicode to be equivalent to the sequence consisting of the character
&quot;LATIN CAPITAL LETTER E&quot; followed by the character &quot;COMBINING ACUTE ACCENT&quot;.
</p>
<p>&quot;LATIN CAPITAL LETTER E WITH ACUTE&quot; is called a &quot;pre-composed&quot; character, and
its equivalence with the sequence is called canonical equivalence.  All
pre-composed characters are said to have a decomposition (into the equivalent
sequence), and the decomposition type is also called canonical.
</p>
<p>However, many more characters have a different type of decomposition, a
&quot;compatible&quot; or &quot;non-canonical&quot; decomposition.  The sequences that form these
decompositions are not considered canonically equivalent to the pre-composed
character.  An example, again in the Latin-1 range, is the &quot;SUPERSCRIPT ONE&quot;.
It is somewhat like a regular digit 1, but not exactly; its decomposition
into the digit 1 is called a &quot;compatible&quot; decomposition, specifically a
&quot;super&quot; decomposition.  There are several such compatibility
decompositions (see <a href="http://www.unicode.org/reports/tr44">http://www.unicode.org/reports/tr44</a>), including one
called &quot;compat&quot;, which means some miscellaneous type of decomposition
that doesn&rsquo;t fit into the decomposition categories that Unicode has chosen.
</p>
<p>Note that most Unicode characters don&rsquo;t have a decomposition, so their
decomposition type is &quot;None&quot;.
</p>
<p>For your convenience, Perl has added the <code>Non_Canonical</code> decomposition
type to mean any of the several compatibility decompositions.
</p>
</dd>
<dt><strong><code>\p{Graph}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bGraph_007d"></a>
<p>Matches any character that is graphic.  Theoretically, this means a character
that on a printer would cause ink to be used.
</p>
</dd>
<dt><strong><code>\p{HorizSpace}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bHorizSpace_007d"></a>
<p>This is the same as <code>\h</code> and <code>\p{Blank}</code>:  a character that changes the
spacing horizontally.
</p>
</dd>
<dt><strong><code>\p{In=*}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bIn_003d_002a_007d"></a>
<p>This is a synonym for <code>\p{Present_In=*}</code>
</p>
</dd>
<dt><strong><code>\p{PerlSpace}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bPerlSpace_007d"></a>
<p>This is the same as <code>\s</code>, restricted to ASCII, namely <code>[&nbsp;\f\n\r\t]<!-- /@w --></code>
and starting in Perl v5.18, experimentally, a vertical tab.
</p>
<p>Mnemonic: Perl&rsquo;s (original) space
</p>
</dd>
<dt><strong><code>\p{PerlWord}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bPerlWord_007d"></a>
<p>This is the same as <code>\w</code>, restricted to ASCII, namely <code>[A-Za-z0-9_]</code>
</p>
<p>Mnemonic: Perl&rsquo;s (original) word.
</p>
</dd>
<dt><strong><code>\p{Posix...}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bPosix_002e_002e_002e_007d"></a>
<p>There are several of these, which are equivalents using the <code>\p</code>
notation for Posix classes and are described in
<a href="perlrecharclass.html#perlrecharclass-POSIX-Character-Classes">perlrecharclass POSIX Character Classes</a>.
</p>
</dd>
<dt><strong><code>\p{Present_In: *}</code></strong>    (Short: <code>\p{In=*}</code>)</dt>
<dd><a name="perlunicode-_005cp_007bPresent_005fIn_003a-_002a_007d-_0028Short_003a-_005cp_007bIn_003d_002a_007d_0029"></a>
<p>This property is used when you need to know in what Unicode version(s) a
character is.
</p>
<p>The &quot;*&quot; above stands for some two digit Unicode version number, such as
<code>1.1</code> or <code>4.0</code>; or the &quot;*&quot; can also be <code>Unassigned</code>.  This property will
match the code points whose final disposition has been settled as of the
Unicode release given by the version number; <code>\p{Present_In: Unassigned}</code>
will match those code points whose meaning has yet to be assigned.
</p>
<p>For example, <code>U+0041</code> &quot;LATIN CAPITAL LETTER A&quot; was present in the very first
Unicode release available, which is <code>1.1</code>, so this property is true for all
valid &quot;*&quot; versions.  On the other hand, <code>U+1EFF</code> was not assigned until version
5.1 when it became &quot;LATIN SMALL LETTER Y WITH LOOP&quot;, so the only &quot;*&quot; that
would match it are 5.1, 5.2, and later.
</p>
<p>Unicode furnishes the <code>Age</code> property from which this is derived.  The problem
with Age is that a strict interpretation of it (which Perl takes) has it
matching the precise release a code point&rsquo;s meaning is introduced in.  Thus
<code>U+0041</code> would match only 1.1; and <code>U+1EFF</code> only 5.1.  This is not usually what
you want.
</p>
<p>Some non-Perl implementations of the Age property may change its meaning to be
the same as the Perl Present_In property; just be aware of that.
</p>
<p>Another confusion with both these properties is that the definition is not
that the code point has been <em>assigned</em>, but that the meaning of the code point
has been <em>determined</em>.  This is because 66 code points will always be
unassigned, and so the Age for them is the Unicode version in which the decision
to make them so was made.  For example, <code>U+FDD0</code> is to be permanently
unassigned to a character, and the decision to do that was made in version 3.1,
so <code>\p{Age=3.1}</code> matches this character, as also does <code>\p{Present_In: 3.1}</code> and up.
</p>
</dd>
<dt><strong><code>\p{Print}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bPrint_007d"></a>
<p>This matches any character that is graphical or blank, except controls.
</p>
</dd>
<dt><strong><code>\p{SpacePerl}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bSpacePerl_007d"></a>
<p>This is the same as <code>\s</code>, including beyond ASCII.
</p>
<p>Mnemonic: Space, as modified by Perl.  (It doesn&rsquo;t include the vertical tab
which both the Posix standard and Unicode consider white space.)
</p>
</dd>
<dt><strong><code>\p{Title}</code></strong> and  <strong><code>\p{Titlecase}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bTitle_007d-and-_005cp_007bTitlecase_007d"></a>
<p>Under case-sensitive matching, these both match the same code points as
<code>\p{General Category=Titlecase_Letter}</code> (<code>\p{gc=lt}</code>).  The difference
is that under <code>/i</code> caseless matching, these match the same as
<code>\p{Cased}</code>, whereas <code>\p{gc=lt}</code> matches <code>\p{Cased_Letter</code>).
</p>
</dd>
<dt><strong><code>\p{VertSpace}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bVertSpace_007d"></a>
<p>This is the same as <code>\v</code>:  A character that changes the spacing vertically.
</p>
</dd>
<dt><strong><code>\p{Word}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bWord_007d"></a>
<p>This is the same as <code>\w</code>, including over 100_000 characters beyond ASCII.
</p>
</dd>
<dt><strong><code>\p{XPosix...}</code></strong></dt>
<dd><a name="perlunicode-_005cp_007bXPosix_002e_002e_002e_007d"></a>
<p>There are several of these, which are the standard Posix classes
extended to the full Unicode range.  They are described in
<a href="perlrecharclass.html#perlrecharclass-POSIX-Character-Classes">perlrecharclass POSIX Character Classes</a>.
</p>
</dd>
</dl>

<hr>
<a name="perlunicode-User_002dDefined-Character-Properties"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-User_002dDefined-Case-Mappings-_0028for-serious-hackers-only_0029" accesskey="n" rel="next">perlunicode User-Defined Case Mappings (for serious hackers only)</a>, Previous: <a href="#perlunicode-Unicode-Character-Properties" accesskey="p" rel="prev">perlunicode Unicode Character Properties</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="User_002dDefined-Character-Properties"></a>
<h4 class="subsection">80.2.5 User-Defined Character Properties</h4>

<p>You can define your own binary character properties by defining subroutines
whose names begin with &quot;In&quot; or &quot;Is&quot;.  (The experimental feature
<a href="perlre.html#perlre-_0028_003f_005b-_005d_0029">perlre <code>(?[ ])</code></a> provides an alternative which allows more complex
definitions.)  The subroutines can be defined in any
package.  The user-defined properties can be used in the regular expression
<code>\p</code> and <code>\P</code> constructs; if you are using a user-defined property from a
package other than the one you are in, you must specify its package in the
<code>\p</code> or <code>\P</code> construct.
</p>
<pre class="verbatim">    # assuming property Is_Foreign defined in Lang::
    package main;  # property package name required
    if ($txt =~ /\p{Lang::IsForeign}+/) { ... }

    package Lang;  # property package name not required
    if ($txt =~ /\p{IsForeign}+/) { ... }
</pre>
<p>Note that the effect is compile-time and immutable once defined.
However, the subroutines are passed a single parameter, which is 0 if
case-sensitive matching is in effect and non-zero if caseless matching
is in effect.  The subroutine may return different values depending on
the value of the flag, and one set of values will immutably be in effect
for all case-sensitive matches, and the other set for all case-insensitive
matches.
</p>
<p>Note that if the regular expression is tainted, then Perl will die rather
than calling the subroutine, where the name of the subroutine is
determined by the tainted data.
</p>
<p>The subroutines must return a specially-formatted string, with one
or more newline-separated lines.  Each line must be one of the following:
</p>
<ul>
<li> A single hexadecimal number denoting a Unicode code point to include.

</li><li> Two hexadecimal numbers separated by horizontal whitespace (space or
tabular characters) denoting a range of Unicode code points to include.

</li><li> Something to include, prefixed by &quot;+&quot;: a built-in character
property (prefixed by &quot;utf8::&quot;) or a fully qualified (including package
name) user-defined character property,
to represent all the characters in that property; two hexadecimal code
points for a range; or a single hexadecimal code point.

</li><li> Something to exclude, prefixed by &quot;-&quot;: an existing character
property (prefixed by &quot;utf8::&quot;) or a fully qualified (including package
name) user-defined character property,
to represent all the characters in that property; two hexadecimal code
points for a range; or a single hexadecimal code point.

</li><li> Something to negate, prefixed &quot;!&quot;: an existing character
property (prefixed by &quot;utf8::&quot;) or a fully qualified (including package
name) user-defined character property,
to represent all the characters in that property; two hexadecimal code
points for a range; or a single hexadecimal code point.

</li><li> Something to intersect with, prefixed by &quot;&amp;&quot;: an existing character
property (prefixed by &quot;utf8::&quot;) or a fully qualified (including package
name) user-defined character property,
for all the characters except the characters in the property; two
hexadecimal code points for a range; or a single hexadecimal code point.

</li></ul>

<p>For example, to define a property that covers both the Japanese
syllabaries (hiragana and katakana), you can define
</p>
<pre class="verbatim">    sub InKana {
        return &lt;&lt;END;
    3040\t309F
    30A0\t30FF
    END
    }
</pre>
<p>Imagine that the here-doc end marker is at the beginning of the line.
Now you can use <code>\p{InKana}</code> and <code>\P{InKana}</code>.
</p>
<p>You could also have used the existing block property names:
</p>
<pre class="verbatim">    sub InKana {
        return &lt;&lt;'END';
    +utf8::InHiragana
    +utf8::InKatakana
    END
    }
</pre>
<p>Suppose you wanted to match only the allocated characters,
not the raw block ranges: in other words, you want to remove
the non-characters:
</p>
<pre class="verbatim">    sub InKana {
        return &lt;&lt;'END';
    +utf8::InHiragana
    +utf8::InKatakana
    -utf8::IsCn
    END
    }
</pre>
<p>The negation is useful for defining (surprise!) negated classes.
</p>
<pre class="verbatim">    sub InNotKana {
        return &lt;&lt;'END';
    !utf8::InHiragana
    -utf8::InKatakana
    +utf8::IsCn
    END
    }
</pre>
<p>This will match all non-Unicode code points, since every one of them is
not in Kana.  You can use intersection to exclude these, if desired, as
this modified example shows:
</p>
<pre class="verbatim">    sub InNotKana {
        return &lt;&lt;'END';
    !utf8::InHiragana
    -utf8::InKatakana
    +utf8::IsCn
    &amp;utf8::Any
    END
    }
</pre>
<p><code>&amp;utf8::Any</code> must be the last line in the definition.
</p>
<p>Intersection is used generally for getting the common characters matched
by two (or more) classes.  It&rsquo;s important to remember not to use &quot;&amp;&quot; for
the first set; that would be intersecting with nothing, resulting in an
empty set.
</p>
<p>(Note that official Unicode properties differ from these in that they
automatically exclude non-Unicode code points and a warning is raised if
a match is attempted on one of those.)
</p>
<hr>
<a name="perlunicode-User_002dDefined-Case-Mappings-_0028for-serious-hackers-only_0029"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Character-Encodings-for-Input-and-Output" accesskey="n" rel="next">perlunicode Character Encodings for Input and Output</a>, Previous: <a href="#perlunicode-User_002dDefined-Character-Properties" accesskey="p" rel="prev">perlunicode User-Defined Character Properties</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="User_002dDefined-Case-Mappings-_0028for-serious-hackers-only_0029"></a>
<h4 class="subsection">80.2.6 User-Defined Case Mappings (for serious hackers only)</h4>

<p><strong>This feature has been removed as of Perl 5.16.</strong>
The CPAN module <a href="../Unicode-Casing/index.html">(Unicode-Casing)</a> provides better functionality without
the drawbacks that this feature had.  If you are using a Perl earlier
than 5.16, this feature was most fully documented in the 5.14 version of
this pod:
<a href="http://perldoc.perl.org/5.14.0/perlunicode.html#User-Defined-Case-Mappings-%28for-serious-hackers-only%29">http://perldoc.perl.org/5.14.0/perlunicode.html#User-Defined-Case-Mappings-%28for-serious-hackers-only%29</a>
</p>
<hr>
<a name="perlunicode-Character-Encodings-for-Input-and-Output"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Unicode-Regular-Expression-Support-Level" accesskey="n" rel="next">perlunicode Unicode Regular Expression Support Level</a>, Previous: <a href="#perlunicode-User_002dDefined-Case-Mappings-_0028for-serious-hackers-only_0029" accesskey="p" rel="prev">perlunicode User-Defined Case Mappings (for serious hackers only)</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Character-Encodings-for-Input-and-Output"></a>
<h4 class="subsection">80.2.7 Character Encodings for Input and Output</h4>

<p>See <a href="../Encode/index.html">(Encode)</a>.
</p>
<hr>
<a name="perlunicode-Unicode-Regular-Expression-Support-Level"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Unicode-Encodings" accesskey="n" rel="next">perlunicode Unicode Encodings</a>, Previous: <a href="#perlunicode-Character-Encodings-for-Input-and-Output" accesskey="p" rel="prev">perlunicode Character Encodings for Input and Output</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Unicode-Regular-Expression-Support-Level"></a>
<h4 class="subsection">80.2.8 Unicode Regular Expression Support Level</h4>

<p>The following list of Unicode supported features for regular expressions describes
all features currently directly supported by core Perl.  The references to &quot;Level N&quot;
and the section numbers refer to the Unicode Technical Standard #18,
&quot;Unicode Regular Expressions&quot;, version 13, from August 2008.
</p>
<ul>
<li> Level 1 - Basic Unicode Support

<pre class="verbatim"> RL1.1   Hex Notation                     - done          [1]
 RL1.2   Properties                       - done          [2][3]
 RL1.2a  Compatibility Properties         - done          [4]
 RL1.3   Subtraction and Intersection     - experimental  [5]
 RL1.4   Simple Word Boundaries           - done          [6]
 RL1.5   Simple Loose Matches             - done          [7]
 RL1.6   Line Boundaries                  - MISSING       [8][9]
 RL1.7   Supplementary Code Points        - done          [10]
</pre>
<dl compact="compact">
<dt>[1]</dt>
<dd><a name="perlunicode-_005b1_005d"></a>
<p>\x{...}
</p>
</dd>
<dt>[2]</dt>
<dd><a name="perlunicode-_005b2_005d"></a>
<p>\p{...} \P{...}
</p>
</dd>
<dt>[3]</dt>
<dd><a name="perlunicode-_005b3_005d"></a>
<p>supports not only minimal list, but all Unicode character properties (see Unicode Character Properties above)
</p>
</dd>
<dt>[4]</dt>
<dd><a name="perlunicode-_005b4_005d"></a>
<p>\d \D \s \S \w \W \X [:prop:] [:^prop:]
</p>
</dd>
<dt>[5]</dt>
<dd><a name="perlunicode-_005b5_005d"></a>
<p>The experimental feature in v5.18 &quot;(?[...])&quot; accomplishes this.  See
<a href="perlre.html#perlre-_0028_003f_005b-_005d_0029">perlre <code>(?[ ])</code></a>.  If you don&rsquo;t want to use an experimental feature,
you can use one of the following:
</p>
<ul>
<li> Regular expression look-ahead

<p>You can mimic class subtraction using lookahead.
For example, what UTS#18 might write as
</p>
<pre class="verbatim">    [{Block=Greek}-[{UNASSIGNED}]]
</pre>
<p>in Perl can be written as:
</p>
<pre class="verbatim">    (?!\p{Unassigned})\p{Block=Greek}
    (?=\p{Assigned})\p{Block=Greek}
</pre>
<p>But in this particular example, you probably really want
</p>
<pre class="verbatim">    \p{Greek}
</pre>
<p>which will match assigned characters known to be part of the Greek script.
</p>
</li><li> CPAN module <a href="../Unicode-Regex-Set/index.html">(Unicode-Regex-Set)</a>

<p>It does implement the full UTS#18 grouping, intersection, union, and
removal (subtraction) syntax.
</p>
</li><li> <a href="#perlunicode-User_002dDefined-Character-Properties">User-Defined Character Properties</a>

<p>&rsquo;+&rsquo; for union, &rsquo;-&rsquo; for removal (set-difference), &rsquo;&amp;&rsquo; for intersection
</p>
</li></ul>

</dd>
<dt>[6]</dt>
<dd><a name="perlunicode-_005b6_005d"></a>
<p>\b \B
</p>
</dd>
<dt>[7]</dt>
<dd><a name="perlunicode-_005b7_005d"></a>
<p>Note that Perl does Full case-folding in matching (but with bugs), not Simple: for example U+1F88 is equivalent to U+1F00 U+03B9, instead of just U+1F80.  This difference matters mainly for certain Greek capital letters with certain modifiers: the Full case-folding decomposes the letter, while the Simple case-folding would map it to a single character.
</p>
</dd>
<dt>[8]</dt>
<dd><a name="perlunicode-_005b8_005d"></a>
<p>Should do ^ and $ also on U+000B (\v in C), FF (\f), CR (\r), CRLF
(\r\n), NEL (U+0085), LS (U+2028), and PS (U+2029); should also affect
&lt;&gt;, $., and script line numbers; should not split lines within CRLF
(i.e. there is no empty line between \r and \n).  For CRLF, try the
<code>:crlf</code> layer (see <a href="../PerlIO/index.html">(PerlIO)</a>).
</p>
</dd>
<dt>[9]</dt>
<dd><a name="perlunicode-_005b9_005d"></a>
<p>Linebreaking conformant with UAX#14 &quot;Unicode Line Breaking Algorithm&quot; is available through the Unicode::LineBreaking module.
</p>
</dd>
<dt>[10]</dt>
<dd><a name="perlunicode-_005b10_005d"></a>
<p>UTF-8/UTF-EBDDIC used in Perl allows not only U+10000 to
U+10FFFF but also beyond U+10FFFF
</p>
</dd>
</dl>

</li><li> Level 2 - Extended Unicode Support

<pre class="verbatim"> RL2.1   Canonical Equivalents           - MISSING       [10][11]
 RL2.2   Default Grapheme Clusters       - MISSING       [12]
 RL2.3   Default Word Boundaries         - MISSING       [14]
 RL2.4   Default Loose Matches           - MISSING       [15]
 RL2.5   Name Properties                 - DONE
 RL2.6   Wildcard Properties             - MISSING

 [10] see UAX#15 &quot;Unicode Normalization Forms&quot;
 [11] have Unicode::Normalize but not integrated to regexes
 [12] have \X but we don't have a &quot;Grapheme Cluster Mode&quot;
 [14] see UAX#29, Word Boundaries
 [15] This is covered in Chapter 3.13 (in Unicode 6.0)
</pre>
</li><li> Level 3 - Tailored Support

<pre class="verbatim"> RL3.1   Tailored Punctuation            - MISSING
 RL3.2   Tailored Grapheme Clusters      - MISSING       [17][18]
 RL3.3   Tailored Word Boundaries        - MISSING
 RL3.4   Tailored Loose Matches          - MISSING
 RL3.5   Tailored Ranges                 - MISSING
 RL3.6   Context Matching                - MISSING       [19]
 RL3.7   Incremental Matches             - MISSING
      ( RL3.8   Unicode Set Sharing )
 RL3.9   Possible Match Sets             - MISSING
 RL3.10  Folded Matching                 - MISSING       [20]
 RL3.11  Submatchers                     - MISSING

 [17] see UAX#10 &quot;Unicode Collation Algorithms&quot;
 [18] have Unicode::Collate but not integrated to regexes
 [19] have (?&lt;=x) and (?=x), but look-aheads or look-behinds
      should see outside of the target substring
 [20] need insensitive matching for linguistic features other
      than case; for example, hiragana to katakana, wide and
      narrow, simplified Han to traditional Han (see UTR#30
      &quot;Character Foldings&quot;)
</pre>
</li></ul>

<hr>
<a name="perlunicode-Unicode-Encodings"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Non_002dcharacter-code-points" accesskey="n" rel="next">perlunicode Non-character code points</a>, Previous: <a href="#perlunicode-Unicode-Regular-Expression-Support-Level" accesskey="p" rel="prev">perlunicode Unicode Regular Expression Support Level</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Unicode-Encodings"></a>
<h4 class="subsection">80.2.9 Unicode Encodings</h4>

<p>Unicode characters are assigned to <em>code points</em>, which are abstract
numbers.  To use these numbers, various encodings are needed.
</p>
<ul>
<li> UTF-8

<p>UTF-8 is a variable-length (1 to 4 bytes), byte-order independent
encoding. For ASCII (and we really do mean 7-bit ASCII, not another
8-bit encoding), UTF-8 is transparent.
</p>
<p>The following table is from Unicode 3.2.
</p>
<pre class="verbatim"> Code Points            1st Byte  2nd Byte  3rd Byte 4th Byte

   U+0000..U+007F       00..7F
   U+0080..U+07FF     * C2..DF    80..BF
   U+0800..U+0FFF       E0      * A0..BF    80..BF
   U+1000..U+CFFF       E1..EC    80..BF    80..BF
   U+D000..U+D7FF       ED        80..9F    80..BF
   U+D800..U+DFFF       +++++ utf16 surrogates, not legal utf8 +++++
   U+E000..U+FFFF       EE..EF    80..BF    80..BF
  U+10000..U+3FFFF      F0      * 90..BF    80..BF    80..BF
  U+40000..U+FFFFF      F1..F3    80..BF    80..BF    80..BF
 U+100000..U+10FFFF     F4        80..8F    80..BF    80..BF
</pre>
<p>Note the gaps marked by &quot;*&quot; before several of the byte entries above.  These are
caused by legal UTF-8 avoiding non-shortest encodings: it is technically
possible to UTF-8-encode a single code point in different ways, but that is
explicitly forbidden, and the shortest possible encoding should always be used
(and that is what Perl does).
</p>
<p>Another way to look at it is via bits:
</p>
<pre class="verbatim">                Code Points  1st Byte  2nd Byte  3rd Byte  4th Byte

                   0aaaaaaa  0aaaaaaa
           00000bbbbbaaaaaa  110bbbbb  10aaaaaa
           ccccbbbbbbaaaaaa  1110cccc  10bbbbbb  10aaaaaa
 00000dddccccccbbbbbbaaaaaa  11110ddd  10cccccc  10bbbbbb  10aaaaaa
</pre>
<p>As you can see, the continuation bytes all begin with &quot;10&quot;, and the
leading bits of the start byte tell how many bytes there are in the
encoded character.
</p>
<p>The original UTF-8 specification allowed up to 6 bytes, to allow
encoding of numbers up to 0x7FFF_FFFF.  Perl continues to allow those,
and has extended that up to 13 bytes to encode code points up to what
can fit in a 64-bit word.  However, Perl will warn if you output any of
these as being non-portable; and under strict UTF-8 input protocols,
they are forbidden.
</p>
<p>The Unicode non-character code points are also disallowed in UTF-8 in
&quot;open interchange&quot;.  See <a href="#perlunicode-Non_002dcharacter-code-points">Non-character code points</a>.
</p>
</li><li> UTF-EBCDIC

<p>Like UTF-8 but EBCDIC-safe, in the way that UTF-8 is ASCII-safe.
</p>
</li><li> UTF-16, UTF-16BE, UTF-16LE, Surrogates, and BOMs (Byte Order Marks)

<p>The followings items are mostly for reference and general Unicode
knowledge, Perl doesn&rsquo;t use these constructs internally.
</p>
<p>Like UTF-8, UTF-16 is a variable-width encoding, but where
UTF-8 uses 8-bit code units, UTF-16 uses 16-bit code units.
All code points occupy either 2 or 4 bytes in UTF-16: code points
<code>U+0000..U+FFFF</code> are stored in a single 16-bit unit, and code
points <code>U+10000..U+10FFFF</code> in two 16-bit units.  The latter case is
using <em>surrogates</em>, the first 16-bit unit being the <em>high
surrogate</em>, and the second being the <em>low surrogate</em>.
</p>
<p>Surrogates are code points set aside to encode the <code>U+10000..U+10FFFF</code>
range of Unicode code points in pairs of 16-bit units.  The <em>high
surrogates</em> are the range <code>U+D800..U+DBFF</code> and the <em>low surrogates</em>
are the range <code>U+DC00..U+DFFF</code>.  The surrogate encoding is
</p>
<pre class="verbatim">    $hi = ($uni - 0x10000) / 0x400 + 0xD800;
    $lo = ($uni - 0x10000) % 0x400 + 0xDC00;
</pre>
<p>and the decoding is
</p>
<pre class="verbatim">    $uni = 0x10000 + ($hi - 0xD800) * 0x400 + ($lo - 0xDC00);
</pre>
<p>Because of the 16-bitness, UTF-16 is byte-order dependent.  UTF-16
itself can be used for in-memory computations, but if storage or
transfer is required either UTF-16BE (big-endian) or UTF-16LE
(little-endian) encodings must be chosen.
</p>
<p>This introduces another problem: what if you just know that your data
is UTF-16, but you don&rsquo;t know which endianness?  Byte Order Marks, or
BOMs, are a solution to this.  A special character has been reserved
in Unicode to function as a byte order marker: the character with the
code point <code>U+FEFF</code> is the BOM.
</p>
<p>The trick is that if you read a BOM, you will know the byte order,
since if it was written on a big-endian platform, you will read the
bytes <code>0xFE 0xFF</code>, but if it was written on a little-endian platform,
you will read the bytes <code>0xFF 0xFE</code>.  (And if the originating platform
was writing in UTF-8, you will read the bytes <code>0xEF 0xBB 0xBF</code>.)
</p>
<p>The way this trick works is that the character with the code point
<code>U+FFFE</code> is not supposed to be in input streams, so the
sequence of bytes <code>0xFF 0xFE</code> is unambiguously &quot;BOM, represented in
little-endian format&quot; and cannot be <code>U+FFFE</code>, represented in big-endian
format&quot;.
</p>
<p>Surrogates have no meaning in Unicode outside their use in pairs to
represent other code points.  However, Perl allows them to be
represented individually internally, for example by saying
<code>chr(0xD801)</code>, so that all code points, not just those valid for open
interchange, are
representable.  Unicode does define semantics for them, such as their
General Category is &quot;Cs&quot;.  But because their use is somewhat dangerous,
Perl will warn (using the warning category &quot;surrogate&quot;, which is a
sub-category of &quot;utf8&quot;) if an attempt is made
to do things like take the lower case of one, or match
case-insensitively, or to output them.  (But don&rsquo;t try this on Perls
before 5.14.)
</p>
</li><li> UTF-32, UTF-32BE, UTF-32LE

<p>The UTF-32 family is pretty much like the UTF-16 family, expect that
the units are 32-bit, and therefore the surrogate scheme is not
needed.  UTF-32 is a fixed-width encoding.  The BOM signatures are
<code>0x00 0x00 0xFE 0xFF</code> for BE and <code>0xFF 0xFE 0x00 0x00</code> for LE.
</p>
</li><li> UCS-2, UCS-4

<p>Legacy, fixed-width encodings defined by the ISO 10646 standard.  UCS-2 is a 16-bit
encoding.  Unlike UTF-16, UCS-2 is not extensible beyond <code>U+FFFF</code>,
because it does not use surrogates.  UCS-4 is a 32-bit encoding,
functionally identical to UTF-32 (the difference being that
UCS-4 forbids neither surrogates nor code points larger than 0x10_FFFF).
</p>
</li><li> UTF-7

<p>A seven-bit safe (non-eight-bit) encoding, which is useful if the
transport or storage is not eight-bit safe.  Defined by RFC 2152.
</p>
</li></ul>

<hr>
<a name="perlunicode-Non_002dcharacter-code-points"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Beyond-Unicode-code-points" accesskey="n" rel="next">perlunicode Beyond Unicode code points</a>, Previous: <a href="#perlunicode-Unicode-Encodings" accesskey="p" rel="prev">perlunicode Unicode Encodings</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Non_002dcharacter-code-points"></a>
<h4 class="subsection">80.2.10 Non-character code points</h4>

<p>66 code points are set aside in Unicode as &quot;non-character code points&quot;.
These all have the Unassigned (Cn) General Category, and they never will
be assigned.  These are never supposed to be in legal Unicode input
streams, so that code can use them as sentinels that can be mixed in
with character data, and they always will be distinguishable from that data.
To keep them out of Perl input streams, strict UTF-8 should be
specified, such as by using the layer <code>:encoding('UTF-8')</code>.  The
non-character code points are the 32 between U+FDD0 and U+FDEF, and the
34 code points U+FFFE, U+FFFF, U+1FFFE, U+1FFFF, ... U+10FFFE, U+10FFFF.
Some people are under the mistaken impression that these are &quot;illegal&quot;,
but that is not true.  An application or cooperating set of applications
can legally use them at will internally; but these code points are
&quot;illegal for open interchange&quot;.  Therefore, Perl will not accept these
from input streams unless lax rules are being used, and will warn
(using the warning category &quot;nonchar&quot;, which is a sub-category of &quot;utf8&quot;) if
an attempt is made to output them.
</p>
<hr>
<a name="perlunicode-Beyond-Unicode-code-points"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Security-Implications-of-Unicode" accesskey="n" rel="next">perlunicode Security Implications of Unicode</a>, Previous: <a href="#perlunicode-Non_002dcharacter-code-points" accesskey="p" rel="prev">perlunicode Non-character code points</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Beyond-Unicode-code-points"></a>
<h4 class="subsection">80.2.11 Beyond Unicode code points</h4>

<p>The maximum Unicode code point is U+10FFFF.  But Perl accepts code
points up to the maximum permissible unsigned number available on the
platform.  However, Perl will not accept these from input streams unless
lax rules are being used, and will warn (using the warning category
&quot;non_unicode&quot;, which is a sub-category of &quot;utf8&quot;) if an attempt is made to
operate on or output them.  For example, <code>uc(0x11_0000)</code> will generate
this warning, returning the input parameter as its result, as the upper
case of every non-Unicode code point is the code point itself.
</p>
<hr>
<a name="perlunicode-Security-Implications-of-Unicode"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Unicode-in-Perl-on-EBCDIC" accesskey="n" rel="next">perlunicode Unicode in Perl on EBCDIC</a>, Previous: <a href="#perlunicode-Beyond-Unicode-code-points" accesskey="p" rel="prev">perlunicode Beyond Unicode code points</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Security-Implications-of-Unicode"></a>
<h4 class="subsection">80.2.12 Security Implications of Unicode</h4>

<p>Read <a href="http://www.unicode.org/reports/tr36">Unicode Security Considerations</a>.
Also, note the following:
</p>
<ul>
<li> Malformed UTF-8

<p>Unfortunately, the original specification of UTF-8 leaves some room for
interpretation of how many bytes of encoded output one should generate
from one input Unicode character.  Strictly speaking, the shortest
possible sequence of UTF-8 bytes should be generated,
because otherwise there is potential for an input buffer overflow at
the receiving end of a UTF-8 connection.  Perl always generates the
shortest length UTF-8, and with warnings on, Perl will warn about
non-shortest length UTF-8 along with other malformations, such as the
surrogates, which are not Unicode code points valid for interchange.
</p>
</li><li> Regular expression pattern matching may surprise you if you&rsquo;re not
accustomed to Unicode.  Starting in Perl 5.14, several pattern
modifiers are available to control this, called the character set
modifiers.  Details are given in <a href="perlre.html#perlre-Character-set-modifiers">perlre Character set modifiers</a>.

</li></ul>

<p>As discussed elsewhere, Perl has one foot (two hooves?) planted in
each of two worlds: the old world of bytes and the new world of
characters, upgrading from bytes to characters when necessary.
If your legacy code does not explicitly use Unicode, no automatic
switch-over to characters should happen.  Characters shouldn&rsquo;t get
downgraded to bytes, either.  It is possible to accidentally mix bytes
and characters, however (see <a href="perluniintro.html#perluniintro-NAME">perluniintro NAME</a>), in which case <code>\w</code> in
regular expressions might start behaving differently (unless the <code>/a</code>
modifier is in effect).  Review your code.  Use warnings and the <code>strict</code> pragma.
</p>
<hr>
<a name="perlunicode-Unicode-in-Perl-on-EBCDIC"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Locales" accesskey="n" rel="next">perlunicode Locales</a>, Previous: <a href="#perlunicode-Security-Implications-of-Unicode" accesskey="p" rel="prev">perlunicode Security Implications of Unicode</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Unicode-in-Perl-on-EBCDIC"></a>
<h4 class="subsection">80.2.13 Unicode in Perl on EBCDIC</h4>

<p>The way Unicode is handled on EBCDIC platforms is still
experimental.  On such platforms, references to UTF-8 encoding in this
document and elsewhere should be read as meaning the UTF-EBCDIC
specified in Unicode Technical Report 16, unless ASCII vs. EBCDIC issues
are specifically discussed. There is no <code>utfebcdic</code> pragma or
&quot;:utfebcdic&quot; layer; rather, &quot;utf8&quot; and &quot;:utf8&quot; are reused to mean
the platform&rsquo;s &quot;natural&quot; 8-bit encoding of Unicode. See <a href="perlebcdic.html#perlebcdic-NAME">perlebcdic NAME</a>
for more discussion of the issues.
</p>
<hr>
<a name="perlunicode-Locales"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-When-Unicode-Does-Not-Happen" accesskey="n" rel="next">perlunicode When Unicode Does Not Happen</a>, Previous: <a href="#perlunicode-Unicode-in-Perl-on-EBCDIC" accesskey="p" rel="prev">perlunicode Unicode in Perl on EBCDIC</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Locales"></a>
<h4 class="subsection">80.2.14 Locales</h4>

<p>See <a href="perllocale.html#perllocale-Unicode-and-UTF_002d8">perllocale Unicode and UTF-8</a>
</p>
<hr>
<a name="perlunicode-When-Unicode-Does-Not-Happen"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-The-_0022Unicode-Bug_0022" accesskey="n" rel="next">perlunicode The &quot;Unicode Bug&quot;</a>, Previous: <a href="#perlunicode-Locales" accesskey="p" rel="prev">perlunicode Locales</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="When-Unicode-Does-Not-Happen"></a>
<h4 class="subsection">80.2.15 When Unicode Does Not Happen</h4>

<p>While Perl does have extensive ways to input and output in Unicode,
and a few other &quot;entry points&quot; like the @ARGV array (which can sometimes be
interpreted as UTF-8), there are still many places where Unicode
(in some encoding or another) could be given as arguments or received as
results, or both, but it is not.
</p>
<p>The following are such interfaces.  Also, see <a href="#perlunicode-The-_0022Unicode-Bug_0022">The &quot;Unicode Bug&quot;</a>.
For all of these interfaces Perl
currently (as of v5.16.0) simply assumes byte strings both as arguments
and results, or UTF-8 strings if the (problematic) <code>encoding</code> pragma has been used.
</p>
<p>One reason that Perl does not attempt to resolve the role of Unicode in
these situations is that the answers are highly dependent on the operating
system and the file system(s).  For example, whether filenames can be
in Unicode and in exactly what kind of encoding, is not exactly a
portable concept.  Similarly for <code>qx</code> and <code>system</code>: how well will the
&quot;command-line interface&quot; (and which of them?) handle Unicode?
</p>
<ul>
<li> chdir, chmod, chown, chroot, exec, link, lstat, mkdir,
rename, rmdir, stat, symlink, truncate, unlink, utime, -X

</li><li> %ENV

</li><li> glob (aka the &lt;*&gt;)

</li><li> open, opendir, sysopen

</li><li> qx (aka the backtick operator), system

</li><li> readdir, readlink

</li></ul>

<hr>
<a name="perlunicode-The-_0022Unicode-Bug_0022"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Forcing-Unicode-in-Perl-_0028Or-Unforcing-Unicode-in-Perl_0029" accesskey="n" rel="next">perlunicode Forcing Unicode in Perl (Or Unforcing Unicode in Perl)</a>, Previous: <a href="#perlunicode-When-Unicode-Does-Not-Happen" accesskey="p" rel="prev">perlunicode When Unicode Does Not Happen</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="The-_0022Unicode-Bug_0022"></a>
<h4 class="subsection">80.2.16 The &quot;Unicode Bug&quot;</h4>

<p>The term, &quot;Unicode bug&quot; has been applied to an inconsistency
on ASCII platforms with the
Unicode code points in the Latin-1 Supplement block, that
is, between 128 and 255.  Without a locale specified, unlike all other
characters or code points, these characters have very different semantics in
byte semantics versus character semantics, unless
<code>use feature 'unicode_strings'</code> is specified, directly or indirectly.
(It is indirectly specified by a <code>use v5.12</code> or higher.)
</p>
<p>In character semantics these upper-Latin1 characters are interpreted as
Unicode code points, which means
they have the same semantics as Latin-1 (ISO-8859-1).
</p>
<p>In byte semantics (without <code>unicode_strings</code>), they are considered to
be unassigned characters, meaning that the only semantics they have is
their ordinal numbers, and that they are
not members of various character classes.  None are considered to match <code>\w</code>
for example, but all match <code>\W</code>.
</p>
<p>Perl 5.12.0 added <code>unicode_strings</code> to force character semantics on
these code points in some circumstances, which fixed portions of the
bug; Perl 5.14.0 fixed almost all of it; and Perl 5.16.0 fixed the
remainder (so far as we know, anyway).  The lesson here is to enable
<code>unicode_strings</code> to avoid the headaches described below.
</p>
<p>The old, problematic behavior affects these areas:
</p>
<ul>
<li> Changing the case of a scalar, that is, using <code>uc()</code>, <code>ucfirst()</code>, <code>lc()</code>,
and <code>lcfirst()</code>, or <code>\L</code>, <code>\U</code>, <code>\u</code> and <code>\l</code> in double-quotish
contexts, such as regular expression substitutions.
Under <code>unicode_strings</code> starting in Perl 5.12.0, character semantics are
generally used.  See <a href="perlfunc.html#perlfunc-lc">perlfunc lc</a> for details on how this works
in combination with various other pragmas.

</li><li> Using caseless (<code>/i</code>) regular expression matching.
Starting in Perl 5.14.0, regular expressions compiled within
the scope of <code>unicode_strings</code> use character semantics
even when executed or compiled into larger
regular expressions outside the scope.

</li><li> Matching any of several properties in regular expressions, namely <code>\b</code>,
<code>\B</code>, <code>\s</code>, <code>\S</code>, <code>\w</code>, <code>\W</code>, and all the Posix character classes
<em>except</em> <code>[[:ascii:]]</code>.
Starting in Perl 5.14.0, regular expressions compiled within
the scope of <code>unicode_strings</code> use character semantics
even when executed or compiled into larger
regular expressions outside the scope.

</li><li> In <code>quotemeta</code> or its inline equivalent <code>\Q</code>, no code points above 127
are quoted in UTF-8 encoded strings, but in byte encoded strings, code
points between 128-255 are always quoted.
Starting in Perl 5.16.0, consistent quoting rules are used within the
scope of <code>unicode_strings</code>, as described in <a href="perlfunc.html#perlfunc-quotemeta">perlfunc quotemeta</a>.

</li></ul>

<p>This behavior can lead to unexpected results in which a string&rsquo;s semantics
suddenly change if a code point above 255 is appended to or removed from it,
which changes the string&rsquo;s semantics from byte to character or vice versa.  As
an example, consider the following program and its output:
</p>
<pre class="verbatim"> $ perl -le'
     no feature 'unicode_strings';
     $s1 = &quot;\xC2&quot;;
     $s2 = &quot;\x{2660}&quot;;
     for ($s1, $s2, $s1.$s2) {
         print /\w/ || 0;
     }
 '
 0
 0
 1
</pre>
<p>If there&rsquo;s no <code>\w</code> in <code>s1</code> or in <code>s2</code>, why does their concatenation have one?
</p>
<p>This anomaly stems from Perl&rsquo;s attempt to not disturb older programs that
didn&rsquo;t use Unicode, and hence had no semantics for characters outside of the
ASCII range (except in a locale), along with Perl&rsquo;s desire to add Unicode
support seamlessly.  The result wasn&rsquo;t seamless: these characters were
orphaned.
</p>
<p>For Perls earlier than those described above, or when a string is passed
to a function outside the subpragma&rsquo;s scope, a workaround is to always
call <code>utf8::upgrade($string)</code>,
or to use the standard module <a href="../Encode/index.html">(Encode)</a>.   Also, a scalar that has any characters
whose ordinal is above 0x100, or which were specified using either of the
<code>\N{...}</code> notations, will automatically have character semantics.
</p>
<hr>
<a name="perlunicode-Forcing-Unicode-in-Perl-_0028Or-Unforcing-Unicode-in-Perl_0029"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Using-Unicode-in-XS" accesskey="n" rel="next">perlunicode Using Unicode in XS</a>, Previous: <a href="#perlunicode-The-_0022Unicode-Bug_0022" accesskey="p" rel="prev">perlunicode The &quot;Unicode Bug&quot;</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Forcing-Unicode-in-Perl-_0028Or-Unforcing-Unicode-in-Perl_0029"></a>
<h4 class="subsection">80.2.17 Forcing Unicode in Perl (Or Unforcing Unicode in Perl)</h4>

<p>Sometimes (see <a href="#perlunicode-When-Unicode-Does-Not-Happen">When Unicode Does Not Happen</a> or <a href="#perlunicode-The-_0022Unicode-Bug_0022">The &quot;Unicode Bug&quot;</a>)
there are situations where you simply need to force a byte
string into UTF-8, or vice versa.  The low-level calls
utf8::upgrade($bytestring) and utf8::downgrade($utf8string[, FAIL_OK]) are
the answers.
</p>
<p>Note that utf8::downgrade() can fail if the string contains characters
that don&rsquo;t fit into a byte.
</p>
<p>Calling either function on a string that already is in the desired state is a
no-op.
</p>
<hr>
<a name="perlunicode-Using-Unicode-in-XS"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Hacking-Perl-to-work-on-earlier-Unicode-versions-_0028for-very-serious-hackers-only_0029" accesskey="n" rel="next">perlunicode Hacking Perl to work on earlier Unicode versions (for very serious hackers only)</a>, Previous: <a href="#perlunicode-Forcing-Unicode-in-Perl-_0028Or-Unforcing-Unicode-in-Perl_0029" accesskey="p" rel="prev">perlunicode Forcing Unicode in Perl (Or Unforcing Unicode in Perl)</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Using-Unicode-in-XS"></a>
<h4 class="subsection">80.2.18 Using Unicode in XS</h4>

<p>If you want to handle Perl Unicode in XS extensions, you may find the
following C APIs useful.  See also <a href="perlguts.html#perlguts-Unicode-Support">perlguts Unicode Support</a> for an
explanation about Unicode at the XS level, and <a href="../perlapi/index.html">(perlapi)</a> for the API
details.
</p>
<ul>
<li> <code>DO_UTF8(sv)</code> returns true if the <code>UTF8</code> flag is on and the bytes
pragma is not in effect.  <code>SvUTF8(sv)</code> returns true if the <code>UTF8</code>
flag is on; the bytes pragma is ignored.  The <code>UTF8</code> flag being on
does <strong>not</strong> mean that there are any characters of code points greater
than 255 (or 127) in the scalar or that there are even any characters
in the scalar.  What the <code>UTF8</code> flag means is that the sequence of
octets in the representation of the scalar is the sequence of UTF-8
encoded code points of the characters of a string.  The <code>UTF8</code> flag
being off means that each octet in this representation encodes a
single character with code point 0..255 within the string.  Perl&rsquo;s
Unicode model is not to use UTF-8 until it is absolutely necessary.

</li><li> <code>uvchr_to_utf8(buf, chr)</code> writes a Unicode character code point into
a buffer encoding the code point as UTF-8, and returns a pointer
pointing after the UTF-8 bytes.  It works appropriately on EBCDIC machines.

</li><li> <code>utf8_to_uvchr_buf(buf, bufend, lenp)</code> reads UTF-8 encoded bytes from a
buffer and
returns the Unicode character code point and, optionally, the length of
the UTF-8 byte sequence.  It works appropriately on EBCDIC machines.

</li><li> <code>utf8_length(start, end)</code> returns the length of the UTF-8 encoded buffer
in characters.  <code>sv_len_utf8(sv)</code> returns the length of the UTF-8 encoded
scalar.

</li><li> <code>sv_utf8_upgrade(sv)</code> converts the string of the scalar to its UTF-8
encoded form.  <code>sv_utf8_downgrade(sv)</code> does the opposite, if
possible.  <code>sv_utf8_encode(sv)</code> is like sv_utf8_upgrade except that
it does not set the <code>UTF8</code> flag.  <code>sv_utf8_decode()</code> does the
opposite of <code>sv_utf8_encode()</code>.  Note that none of these are to be
used as general-purpose encoding or decoding interfaces: <code>use Encode</code>
for that.  <code>sv_utf8_upgrade()</code> is affected by the encoding pragma
but <code>sv_utf8_downgrade()</code> is not (since the encoding pragma is
designed to be a one-way street).

</li><li> <code>is_utf8_string(buf, len)</code> returns true if <code>len</code> bytes of the buffer
are valid UTF-8.

</li><li> <code>is_utf8_char_buf(buf, buf_end)</code> returns true if the pointer points to
a valid UTF-8 character.

</li><li> <code>UTF8SKIP(buf)</code> will return the number of bytes in the UTF-8 encoded
character in the buffer.  <code>UNISKIP(chr)</code> will return the number of bytes
required to UTF-8-encode the Unicode character code point.  <code>UTF8SKIP()</code>
is useful for example for iterating over the characters of a UTF-8
encoded buffer; <code>UNISKIP()</code> is useful, for example, in computing
the size required for a UTF-8 encoded buffer.

</li><li> <code>utf8_distance(a, b)</code> will tell the distance in characters between the
two pointers pointing to the same UTF-8 encoded buffer.

</li><li> <code>utf8_hop(s, off)</code> will return a pointer to a UTF-8 encoded buffer
that is <code>off</code> (positive or negative) Unicode characters displaced
from the UTF-8 buffer <code>s</code>.  Be careful not to overstep the buffer:
<code>utf8_hop()</code> will merrily run off the end or the beginning of the
buffer if told to do so.

</li><li> <code>pv_uni_display(dsv, spv, len, pvlim, flags)</code> and
<code>sv_uni_display(dsv, ssv, pvlim, flags)</code> are useful for debugging the
output of Unicode strings and scalars.  By default they are useful
only for debugging&ndash;they display <strong>all</strong> characters as hexadecimal code
points&ndash;but with the flags <code>UNI_DISPLAY_ISPRINT</code>,
<code>UNI_DISPLAY_BACKSLASH</code>, and <code>UNI_DISPLAY_QQ</code> you can make the
output more readable.

</li><li> <code>foldEQ_utf8(s1, pe1, l1, u1, s2, pe2, l2, u2)</code> can be used to
compare two strings case-insensitively in Unicode.  For case-sensitive
comparisons you can just use <code>memEQ()</code> and <code>memNE()</code> as usual, except
if one string is in utf8 and the other isn&rsquo;t.

</li></ul>

<p>For more information, see <a href="../perlapi/index.html">(perlapi)</a>, and <samp>utf8.c</samp> and <samp>utf8.h</samp>
in the Perl source code distribution.
</p>
<hr>
<a name="perlunicode-Hacking-Perl-to-work-on-earlier-Unicode-versions-_0028for-very-serious-hackers-only_0029"></a>
<div class="header">
<p>
Previous: <a href="#perlunicode-Using-Unicode-in-XS" accesskey="p" rel="prev">perlunicode Using Unicode in XS</a>, Up: <a href="#perlunicode-DESCRIPTION" accesskey="u" rel="up">perlunicode DESCRIPTION</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Hacking-Perl-to-work-on-earlier-Unicode-versions-_0028for-very-serious-hackers-only_0029"></a>
<h4 class="subsection">80.2.19 Hacking Perl to work on earlier Unicode versions (for very serious hackers only)</h4>

<p>Perl by default comes with the latest supported Unicode version built in, but
you can change to use any earlier one.
</p>
<p>Download the files in the desired version of Unicode from the Unicode web
site <a href="http://www.unicode.org">http://www.unicode.org</a>).  These should replace the existing files in
<samp>lib/unicore</samp> in the Perl source tree.  Follow the instructions in
<samp>README.perl</samp> in that directory to change some of their names, and then build
perl (see <a href="../INSTALL/index.html">(INSTALL)</a>).
</p>
<hr>
<a name="perlunicode-BUGS"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-SEE-ALSO" accesskey="n" rel="next">perlunicode SEE ALSO</a>, Previous: <a href="#perlunicode-DESCRIPTION" accesskey="p" rel="prev">perlunicode DESCRIPTION</a>, Up: <a href="#perlunicode" accesskey="u" rel="up">perlunicode</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="BUGS-10"></a>
<h3 class="section">80.3 BUGS</h3>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Interaction-with-Locales" accesskey="1">perlunicode Interaction with Locales</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Problems-with-characters-in-the-Latin_002d1-Supplement-range" accesskey="2">perlunicode Problems with characters in the Latin-1 Supplement range</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Interaction-with-Extensions" accesskey="3">perlunicode Interaction with Extensions</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Speed" accesskey="4">perlunicode Speed</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Problems-on-EBCDIC-platforms" accesskey="5">perlunicode Problems on EBCDIC platforms</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#perlunicode-Porting-code-from-perl_002d5_002e6_002eX" accesskey="6">perlunicode Porting code from perl-5.6.X</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="perlunicode-Interaction-with-Locales"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Problems-with-characters-in-the-Latin_002d1-Supplement-range" accesskey="n" rel="next">perlunicode Problems with characters in the Latin-1 Supplement range</a>, Up: <a href="#perlunicode-BUGS" accesskey="u" rel="up">perlunicode BUGS</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Interaction-with-Locales"></a>
<h4 class="subsection">80.3.1 Interaction with Locales</h4>

<p>See <a href="perllocale.html#perllocale-Unicode-and-UTF_002d8">perllocale Unicode and UTF-8</a>
</p>
<hr>
<a name="perlunicode-Problems-with-characters-in-the-Latin_002d1-Supplement-range"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Interaction-with-Extensions" accesskey="n" rel="next">perlunicode Interaction with Extensions</a>, Previous: <a href="#perlunicode-Interaction-with-Locales" accesskey="p" rel="prev">perlunicode Interaction with Locales</a>, Up: <a href="#perlunicode-BUGS" accesskey="u" rel="up">perlunicode BUGS</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Problems-with-characters-in-the-Latin_002d1-Supplement-range"></a>
<h4 class="subsection">80.3.2 Problems with characters in the Latin-1 Supplement range</h4>

<p>See <a href="#perlunicode-The-_0022Unicode-Bug_0022">The &quot;Unicode Bug&quot;</a>
</p>
<hr>
<a name="perlunicode-Interaction-with-Extensions"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Speed" accesskey="n" rel="next">perlunicode Speed</a>, Previous: <a href="#perlunicode-Problems-with-characters-in-the-Latin_002d1-Supplement-range" accesskey="p" rel="prev">perlunicode Problems with characters in the Latin-1 Supplement range</a>, Up: <a href="#perlunicode-BUGS" accesskey="u" rel="up">perlunicode BUGS</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Interaction-with-Extensions"></a>
<h4 class="subsection">80.3.3 Interaction with Extensions</h4>

<p>When Perl exchanges data with an extension, the extension should be
able to understand the UTF8 flag and act accordingly. If the
extension doesn&rsquo;t recognize that flag, it&rsquo;s likely that the extension
will return incorrectly-flagged data.
</p>
<p>So if you&rsquo;re working with Unicode data, consult the documentation of
every module you&rsquo;re using if there are any issues with Unicode data
exchange. If the documentation does not talk about Unicode at all,
suspect the worst and probably look at the source to learn how the
module is implemented. Modules written completely in Perl shouldn&rsquo;t
cause problems. Modules that directly or indirectly access code written
in other programming languages are at risk.
</p>
<p>For affected functions, the simple strategy to avoid data corruption is
to always make the encoding of the exchanged data explicit. Choose an
encoding that you know the extension can handle. Convert arguments passed
to the extensions to that encoding and convert results back from that
encoding. Write wrapper functions that do the conversions for you, so
you can later change the functions when the extension catches up.
</p>
<p>To provide an example, let&rsquo;s say the popular Foo::Bar::escape_html
function doesn&rsquo;t deal with Unicode data yet. The wrapper function
would convert the argument to raw UTF-8 and convert the result back to
Perl&rsquo;s internal representation like so:
</p>
<pre class="verbatim">    sub my_escape_html ($) {
        my($what) = shift;
        return unless defined $what;
        Encode::decode_utf8(Foo::Bar::escape_html(
                                         Encode::encode_utf8($what)));
    }
</pre>
<p>Sometimes, when the extension does not convert data but just stores
and retrieves them, you will be able to use the otherwise
dangerous Encode::_utf8_on() function. Let&rsquo;s say the popular
<code>Foo::Bar</code> extension, written in C, provides a <code>param</code> method that
lets you store and retrieve data according to these prototypes:
</p>
<pre class="verbatim">    $self-&gt;param($name, $value);            # set a scalar
    $value = $self-&gt;param($name);           # retrieve a scalar
</pre>
<p>If it does not yet provide support for any encoding, one could write a
derived class with such a <code>param</code> method:
</p>
<pre class="verbatim">    sub param {
      my($self,$name,$value) = @_;
      utf8::upgrade($name);     # make sure it is UTF-8 encoded
      if (defined $value) {
        utf8::upgrade($value);  # make sure it is UTF-8 encoded
        return $self-&gt;SUPER::param($name,$value);
      } else {
        my $ret = $self-&gt;SUPER::param($name);
        Encode::_utf8_on($ret); # we know, it is UTF-8 encoded
        return $ret;
      }
    }
</pre>
<p>Some extensions provide filters on data entry/exit points, such as
DB_File::filter_store_key and family. Look out for such filters in
the documentation of your extensions, they can make the transition to
Unicode data much easier.
</p>
<hr>
<a name="perlunicode-Speed"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Problems-on-EBCDIC-platforms" accesskey="n" rel="next">perlunicode Problems on EBCDIC platforms</a>, Previous: <a href="#perlunicode-Interaction-with-Extensions" accesskey="p" rel="prev">perlunicode Interaction with Extensions</a>, Up: <a href="#perlunicode-BUGS" accesskey="u" rel="up">perlunicode BUGS</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Speed"></a>
<h4 class="subsection">80.3.4 Speed</h4>

<p>Some functions are slower when working on UTF-8 encoded strings than
on byte encoded strings.  All functions that need to hop over
characters such as length(), substr() or index(), or matching regular
expressions can work <strong>much</strong> faster when the underlying data are
byte-encoded.
</p>
<p>In Perl 5.8.0 the slowness was often quite spectacular; in Perl 5.8.1
a caching scheme was introduced which will hopefully make the slowness
somewhat less spectacular, at least for some operations.  In general,
operations with UTF-8 encoded strings are still slower. As an example,
the Unicode properties (character classes) like <code>\p{Nd}</code> are known to
be quite a bit slower (5-20 times) than their simpler counterparts
like <code>\d</code> (then again, there are hundreds of Unicode characters matching <code>Nd</code>
compared with the 10 ASCII characters matching <code>d</code>).
</p>
<hr>
<a name="perlunicode-Problems-on-EBCDIC-platforms"></a>
<div class="header">
<p>
Next: <a href="#perlunicode-Porting-code-from-perl_002d5_002e6_002eX" accesskey="n" rel="next">perlunicode Porting code from perl-5.6.X</a>, Previous: <a href="#perlunicode-Speed" accesskey="p" rel="prev">perlunicode Speed</a>, Up: <a href="#perlunicode-BUGS" accesskey="u" rel="up">perlunicode BUGS</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Problems-on-EBCDIC-platforms"></a>
<h4 class="subsection">80.3.5 Problems on EBCDIC platforms</h4>

<p>There are several known problems with Perl on EBCDIC platforms.  If you
want to use Perl there, send email to perlbug@perl.org.
</p>
<p>In earlier versions, when byte and character data were concatenated,
the new string was sometimes created by
decoding the byte strings as <em>ISO 8859-1 (Latin-1)</em>, even if the
old Unicode string used EBCDIC.
</p>
<p>If you find any of these, please report them as bugs.
</p>
<hr>
<a name="perlunicode-Porting-code-from-perl_002d5_002e6_002eX"></a>
<div class="header">
<p>
Previous: <a href="#perlunicode-Problems-on-EBCDIC-platforms" accesskey="p" rel="prev">perlunicode Problems on EBCDIC platforms</a>, Up: <a href="#perlunicode-BUGS" accesskey="u" rel="up">perlunicode BUGS</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="Porting-code-from-perl_002d5_002e6_002eX"></a>
<h4 class="subsection">80.3.6 Porting code from perl-5.6.X</h4>

<p>Perl 5.8 has a different Unicode model from 5.6. In 5.6 the programmer
was required to use the <code>utf8</code> pragma to declare that a given scope
expected to deal with Unicode data and had to make sure that only
Unicode data were reaching that scope. If you have code that is
working with 5.6, you will need some of the following adjustments to
your code. The examples are written such that the code will continue
to work under 5.6, so you should be safe to try them out.
</p>
<ul>
<li> A filehandle that should read or write UTF-8

<pre class="verbatim">  if ($] &gt; 5.008) {
    binmode $fh, &quot;:encoding(utf8)&quot;;
  }
</pre>
</li><li> A scalar that is going to be passed to some extension

<p>Be it Compress::Zlib, Apache::Request or any extension that has no
mention of Unicode in the manpage, you need to make sure that the
UTF8 flag is stripped off. Note that at the time of this writing
(January 2012) the mentioned modules are not UTF-8-aware. Please
check the documentation to verify if this is still true.
</p>
<pre class="verbatim">  if ($] &gt; 5.008) {
    require Encode;
    $val = Encode::encode_utf8($val); # make octets
  }
</pre>
</li><li> A scalar we got back from an extension

<p>If you believe the scalar comes back as UTF-8, you will most likely
want the UTF8 flag restored:
</p>
<pre class="verbatim">  if ($] &gt; 5.008) {
    require Encode;
    $val = Encode::decode_utf8($val);
  }
</pre>
</li><li> Same thing, if you are really sure it is UTF-8

<pre class="verbatim">  if ($] &gt; 5.008) {
    require Encode;
    Encode::_utf8_on($val);
  }
</pre>
</li><li> A wrapper for fetchrow_array and fetchrow_hashref

<p>When the database contains only UTF-8, a wrapper function or method is
a convenient way to replace all your fetchrow_array and
fetchrow_hashref calls. A wrapper function will also make it easier to
adapt to future enhancements in your database driver. Note that at the
time of this writing (January 2012), the DBI has no standardized way
to deal with UTF-8 data. Please check the documentation to verify if
that is still true.
</p>
<pre class="verbatim">  sub fetchrow {
    # $what is one of fetchrow_{array,hashref}
    my($self, $sth, $what) = @_;
    if ($] &lt; 5.008) {
      return $sth-&gt;$what;
    } else {
      require Encode;
      if (wantarray) {
        my @arr = $sth-&gt;$what;
        for (@arr) {
          defined &amp;&amp; /[^\000-\177]/ &amp;&amp; Encode::_utf8_on($_);
        }
        return @arr;
      } else {
        my $ret = $sth-&gt;$what;
        if (ref $ret) {
          for my $k (keys %$ret) {
            defined
            &amp;&amp; /[^\000-\177]/
            &amp;&amp; Encode::_utf8_on($_) for $ret-&gt;{$k};
          }
          return $ret;
        } else {
          defined &amp;&amp; /[^\000-\177]/ &amp;&amp; Encode::_utf8_on($_) for $ret;
          return $ret;
        }
      }
    }
  }
</pre>
</li><li> A large scalar that you know can only contain ASCII

<p>Scalars that contain only ASCII and are marked as UTF-8 are sometimes
a drag to your program. If you recognize such a situation, just remove
the UTF8 flag:
</p>
<pre class="verbatim">  utf8::downgrade($val) if $] &gt; 5.008;
</pre>
</li></ul>

<hr>
<a name="perlunicode-SEE-ALSO"></a>
<div class="header">
<p>
Previous: <a href="#perlunicode-BUGS" accesskey="p" rel="prev">perlunicode BUGS</a>, Up: <a href="#perlunicode" accesskey="u" rel="up">perlunicode</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<a name="SEE-ALSO-40"></a>
<h3 class="section">80.4 SEE ALSO</h3>

<p><a href="perlunitut.html#perlunitut-NAME">perlunitut NAME</a>, <a href="perluniintro.html#perluniintro-NAME">perluniintro NAME</a>, <a href="../perluniprops/index.html">(perluniprops)</a>, <a href="../Encode/index.html">(Encode)</a>, <a href="../open/index.html">(open)</a>, <a href="../utf8/index.html">(utf8)</a>, <a href="../bytes/index.html">(bytes)</a>,
<a href="perlretut.html#perlretut-NAME">perlretut NAME</a>, <a href="perlvar.html#perlvar-_0024_007b_005eUNICODE_007d">perlvar ${^UNICODE}</a>
<a href="http://www.unicode.org/reports/tr44">http://www.unicode.org/reports/tr44</a>).
</p>
<hr>
<div class="header">
<p>
Previous: <a href="#perlunicode-BUGS" accesskey="p" rel="prev">perlunicode BUGS</a>, Up: <a href="#perlunicode" accesskey="u" rel="up">perlunicode</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>



</body>
</html>
